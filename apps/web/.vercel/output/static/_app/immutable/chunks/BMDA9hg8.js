import{I as z,M as A,S as U}from"./BhPu-S6K.js";import{L,f as N,S as v,d as E,i as O,g as B,l as _,o as H,a as j,v as q,e as F,p as G,n as K,c as W,t as Z,b as X,r as Y,h as J,j as Q,k as V,y as ee,B as te,D as se,w as oe,m as re,x as ne,q as ae,s as ce,A as ie,C as le,z as pe,u as he}from"./CDUSxSYR.js";import{T as ge,e as de,c as fe,f as me,d as Se,g as we,a as ye,b as xe,h as be}from"./Dyjw1x4N.js";const x=["https://corsproxy.io/?","https://api.allorigins.win/raw?url="],f="https://ozbcoz.com/Songs/";async function w(e){try{const t=await fetch(e,{mode:"cors"});if(t.ok)return await t.text()}catch{}for(const t of x)try{const r=t+encodeURIComponent(e),o=await fetch(r);if(o.ok)return await o.text()}catch{}throw new Error(`Failed to fetch ${e} - all proxies failed`)}function b(e){const t=[],r=/<a\s+href="song\.php\?ID=(\d+),([^"]+)"[^>]*>([^<]+)<\/a>\s*(?:\[([A-G][#b]?m?)\])?\s*(?:\((\d+)\))?/gi;let o;for(;(o=r.exec(e))!==null;){const[,s,,i,n,h]=o,a=i.trim();let l=a,p;const u=a.lastIndexOf(" - ");u>0&&(l=a.substring(0,u).trim(),p=a.substring(u+3).trim()),t.push({id:s,title:l,artist:p,key:n||void 0,pageNumber:h||void 0,url:`${f}song.php?ID=${s},soprano`})}return t}function C(e,t){const r=e.match(/<h1[^>]*>([^<]+)<\/h1>/i)||e.match(/<title>([^<]+)<\/title>/i);let o=r?r[1].trim():"Unknown";o=o.replace(/\s*[-â€“]\s*ozbcoz\.com.*$/i,"").trim();const s=e.match(/(?:Artist|By)[:\s]*([^<\n]+)/i),i=s?s[1].trim():void 0,n=e.match(/(?:Writer|Written by)[:\s]*([^<\n]+)/i),h=n?n[1].trim():void 0,a=e.match(/(?:Key)[:\s]*([A-G][#b]?m?)/i),l=a?a[1]:void 0,p=e.match(/(?:Tempo|BPM)[:\s]*(\d+)/i),u=p?parseInt(p[1],10):void 0,g=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/i),y=g?`https://www.youtube.com/watch?v=${g[1]}`:void 0;let c="";const m=e.match(/<pre[^>]*class="[^"]*chordpro[^"]*"[^>]*>([\s\S]*?)<\/pre>/i);if(m)c=m[1];else{const d=e.match(/<pre[^>]*>([\s\S]*?)<\/pre>/i);if(d)c=d[1];else{const S=e.match(/<div[^>]*class="[^"]*song[^"]*"[^>]*>([\s\S]*?)<\/div>/i);S&&(c=S[1])}}return c=c.replace(/<br\s*\/?>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim(),c||(c=I(e)),!c.includes("{title:")&&!c.includes("{t:")&&(c=D(o,i,l,u)+`
`+c),{id:t,title:o,artist:i,writer:h,key:l,tempo:u,content:c,youtubeUrl:y}}function I(e){const t=[],r=/<tr[^>]*>([\s\S]*?)<\/tr>/gi,o=/<td[^>]*>([\s\S]*?)<\/td>/gi,s=[];let i;for(;(i=r.exec(e))!==null;){const n=[];let h;const a=i[1];for(;(h=o.exec(a))!==null;)n.push(h[1].replace(/<[^>]+>/g,"").trim());n.length>0&&s.push(n)}for(let n=0;n<s.length;n+=2){const h=s[n],a=s[n+1]||[];let l="";for(let p=0;p<Math.max(h.length,a.length);p++){const u=h[p]||"",g=a[p]||"";u&&(l+=`[${u}]`),l+=g}l.trim()&&t.push(l)}return t.join(`
`)}function D(e,t,r,o){const s=[];return s.push(`{title: ${e}}`),t&&s.push(`{artist: ${t}}`),r&&s.push(`{key: ${r}}`),o&&s.push(`{tempo: ${o}}`),s.join(`
`)}async function M(e){const t=`${f}index.php?sort=ttl`,r=await w(t),o=b(r),s=e.toLowerCase();return o.filter(i=>i.title.toLowerCase().includes(s)||i.artist&&i.artist.toLowerCase().includes(s))}async function T(e){const t=`${f}song.php?ID=${e},soprano`,r=await w(t);return C(r,e)}function P(e,t){return{title:e.title,artist:e.artist||e.writer,key:e.key,tempo:e.tempo,content:e.content,tags:["imported","ozbcoz"]}}export{z as INSTRUMENTS,L as LibraryDoc,A as MUSICAL_KEYS,U as SUBSCRIPTION_TIERS,N as SessionDoc,v as SongDoc,E as SpaceDoc,ge as TIER_INFO,O as applyDocState,de as canUpgrade,B as computeContentHash,P as convertToGigwidgetSong,_ as createAnonymousUser,H as createArrangement,j as createLibraryDoc,q as createSession,F as createSessionDoc,G as createSnapshot,K as createSong,W as createSongDoc,Z as createSpace,X as createSpaceDoc,Y as detectConflict,J as encodeDocState,Q as generateId,V as generateLocalUserId,fe as getEffectiveTier,me as getNextTier,ee as getNoteIndex,T as getOzbcozSongDetail,Se as getRequiredTierForPermission,te as getSemitonesBetweenKeys,se as getTransposeDisplayName,we as getUserPermissions,ye as hasAllPermissions,xe as hasAnyPermission,be as hasPermission,oe as isSessionExpired,re as mergeDocStates,ne as parseChord,ae as pruneSnapshots,ce as resolveConflict,M as searchOzbcozSongs,ie as transposeChord,le as transposeChordProContent,pe as transposeNote,he as upgradeToAuthenticatedUser};
//# sourceMappingURL=BMDA9hg8.js.map
