import{b as lt,d as ut,O as ht,g as ve,f as Ot,l as Nt,s as Pe,h as Pt,i as ft,o as Mt,v as Ut,j as dt,k as Bt,n as Ft,w as Z,p as he,e as jt,r as Le,q as xe,u as pt,x as gt,y as ne,z as Fe,A as re,B as je,C as Ke,E as nt,F as qt,G as Je,H as Wt,I as Ht,a as yt,J as Vt,K as Yt,L as zt,M as Gt,N as bt,P as $t,Q as ue,U as De,R as mt,S as _t,D as rt}from"./CKx7fsl1.js";import{c as le,g as Kt}from"./Cpj98o6Y.js";import{IndexeddbPersistence as Nn}from"./C6md0y2C.js";import{v as Jt,j as Xt}from"./CDUSxSYR.js";class wt{_observers=new Map;on(l,g){let O=this._observers.get(l);O||(O=new Set,this._observers.set(l,O)),O.add(g)}off(l,g){const O=this._observers.get(l);O&&(O.delete(g),O.size===0&&this._observers.delete(l))}once(l,g){const O=(...x)=>{this.off(l,O),g(...x)};this.on(l,O)}emit(l,g){const O=this._observers.get(l);O&&O.forEach(x=>{try{x(...g)}catch(y){console.error(`Error in event handler for "${l}":`,y)}})}destroy(){this._observers.clear()}}const qe="12345678-1234-5678-1234-56789abcdef0",Qt="12345678-1234-5678-1234-56789abcdef1",Zt=512;function vt(){return typeof navigator<"u"&&"bluetooth"in navigator}class it extends wt{doc;sessionId;deviceName;peers=new Map;_connected=!1;pendingChunks=new Map;constructor(l,g){super(),this.doc=l,this.sessionId=g.sessionId,this.deviceName=g.deviceName??`Gigwidget-${g.sessionId.slice(0,8)}`,this.onDocUpdate=this.onDocUpdate.bind(this)}get connected(){return this._connected}get peerCount(){return this.peers.size}async scan(){if(!vt())return this.emit("error",[new Error("Web Bluetooth is not available")]),null;try{return await navigator.bluetooth.requestDevice({filters:[{services:[qe]},{namePrefix:"Gigwidget-"}],optionalServices:[qe]})}catch(l){return l.name!=="NotFoundError"&&this.emit("error",[l]),null}}async connectToDevice(l){try{const g=await l.gatt?.connect();if(!g)throw new Error("Failed to connect to GATT server");const x=await(await g.getPrimaryService(qe)).getCharacteristic(Qt);await x.startNotifications(),x.addEventListener("characteristicvaluechanged",k=>{const b=k.target.value;b&&this.handleIncomingData(l.id,new Uint8Array(b.buffer))});const y={id:l.id,name:l.name??"Unknown",device:l,characteristic:x};this.peers.set(l.id,y),this._connected||(this.doc.on("update",this.onDocUpdate),this._connected=!0),await this.requestFullState(y),this.emit("peer-connected",[{peer:y}])}catch(g){this.emit("error",[g])}}disconnect(){this.doc.off("update",this.onDocUpdate);for(const l of this.peers.values())l.device.gatt?.disconnect();this.peers.clear(),this._connected=!1,this.emit("disconnected",[{}])}onDocUpdate(l,g){g!==this&&this.broadcastUpdate(l)}async broadcastUpdate(l){const g=this.chunkData(l);for(const O of this.peers.values())if(O.characteristic)try{for(const x of g)await O.characteristic.writeValue(new Uint8Array(x))}catch(x){console.error(`Failed to send update to peer ${O.id}:`,x),this.handlePeerDisconnect(O.id)}}handleIncomingData(l,g){const O=g[0],x=(O&128)!==0,y=(O&64)!==0,k=g.slice(1);if(x){let b=this.pendingChunks.get(l);if(b||(b=[],this.pendingChunks.set(l,b)),b.push(k),y){const o=this.combineChunks(b);this.pendingChunks.delete(l),this.applyUpdate(o)}}else this.applyUpdate(k)}applyUpdate(l){try{lt(this.doc,l,this)}catch(g){console.error("Failed to apply Yjs update:",g)}}async requestFullState(l){const g=ut(this.doc),O=new Uint8Array([1,...g]);try{await l.characteristic?.writeValue(O)}catch(x){console.error("Failed to request state:",x)}}handlePeerDisconnect(l){const g=this.peers.get(l);g&&(this.peers.delete(l),this.pendingChunks.delete(l),this.emit("peer-disconnected",[{peer:g}]),this.peers.size===0&&(this._connected=!1,this.doc.off("update",this.onDocUpdate)))}chunkData(l){const g=[],O=Zt-1;for(let x=0;x<l.length;x+=O){const y=x+O>=l.length,k=l.slice(x,x+O),b=128|(y?64:0),o=new Uint8Array([b,...k]);g.push(o)}return g}combineChunks(l){const g=l.reduce((y,k)=>y+k.length,0),O=new Uint8Array(g);let x=0;for(const y of l)O.set(y,x),x+=y.length;return O}destroy(){this.disconnect(),super.destroy()}}const en=1200,tn=2500,Me=3e4,ze=w=>{if(w.shouldConnect&&w.ws===null){const l=new WebSocket(w.url),g=w.binaryType;let O=null;g&&(l.binaryType=g),w.ws=l,w.connecting=!0,w.connected=!1,l.onmessage=k=>{w.lastMessageReceived=ve();const b=k.data,o=typeof b=="string"?JSON.parse(b):b;o&&o.type==="pong"&&(clearTimeout(O),O=setTimeout(y,Me/2)),w.emit("message",[o,w])};const x=k=>{w.ws!==null&&(w.ws=null,w.connecting=!1,w.connected?(w.connected=!1,w.emit("disconnect",[{type:"disconnect",error:k},w])):w.unsuccessfulReconnects++,setTimeout(ze,Ot(Nt(w.unsuccessfulReconnects+1)*en,tn),w)),clearTimeout(O)},y=()=>{w.ws===l&&w.send({type:"ping"})};l.onclose=()=>x(null),l.onerror=k=>x(k),l.onopen=()=>{w.lastMessageReceived=ve(),w.connecting=!1,w.connected=!0,w.unsuccessfulReconnects=0,w.emit("connect",[{type:"connect"},w]),O=setTimeout(y,Me/2)}}};class nn extends ht{constructor(l,{binaryType:g}={}){super(),this.url=l,this.ws=null,this.binaryType=g||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Me<ve()-this.lastMessageReceived&&this.ws.close()},Me/2),ze(this)}send(l){this.ws&&this.ws.send(JSON.stringify(l))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&ze(this)}}const Et=new Map;class rn{constructor(l){this.room=l,this.onmessage=null,this._onChange=g=>g.key===l&&this.onmessage!==null&&this.onmessage({data:ft(g.newValue||"")}),Mt(this._onChange)}postMessage(l){Ut.setItem(this.room,dt(Bt(l)))}close(){Ft(this._onChange)}}const sn=typeof BroadcastChannel>"u"?rn:BroadcastChannel,Xe=w=>Pe(Et,w,()=>{const l=Pt(),g=new sn(w);return g.onmessage=O=>l.forEach(x=>x(O.data,"broadcastchannel")),{bc:g,subs:l}}),on=(w,l)=>(Xe(w).subs.add(l),l),an=(w,l)=>{const g=Xe(w),O=g.subs.delete(l);return O&&g.subs.size===0&&(g.bc.close(),Et.delete(w)),O},cn=(w,l,g=null)=>{const O=Xe(w);O.bc.postMessage(l),O.subs.forEach(x=>x(l,g))},ln=()=>{let w=!0;return(l,g)=>{if(w){w=!1;try{l()}finally{w=!0}}else g!==void 0&&g()}};function Ne(w){throw new Error('Could not dynamically require "'+w+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var We={exports:{}},st;function un(){return st||(st=1,(function(w,l){(function(g){w.exports=g()})(function(){var g=Math.floor,O=Math.abs,x=Math.pow;return(function(){function y(k,b,o){function T(c,p){if(!b[c]){if(!k[c]){var a=typeof Ne=="function"&&Ne;if(!p&&a)return a(c,!0);if(D)return D(c,!0);var _=new Error("Cannot find module '"+c+"'");throw _.code="MODULE_NOT_FOUND",_}var N=b[c]={exports:{}};k[c][0].call(N.exports,function(A){var P=k[c][1][A];return T(P||A)},N,N.exports,y,k,b,o)}return b[c].exports}for(var D=typeof Ne=="function"&&Ne,r=0;r<o.length;r++)T(o[r]);return T}return y})()({1:[function(y,k,b){function o(u){var h=u.length;if(0<h%4)throw new Error("Invalid string. Length must be a multiple of 4");var E=u.indexOf("=");E===-1&&(E=h);var d=E===h?0:4-E%4;return[E,d]}function T(u,h,E){return 3*(h+E)/4-E}function D(u){var h,E,d=o(u),R=d[0],M=d[1],m=new N(T(u,R,M)),C=0,U=0<M?R-4:R;for(E=0;E<U;E+=4)h=_[u.charCodeAt(E)]<<18|_[u.charCodeAt(E+1)]<<12|_[u.charCodeAt(E+2)]<<6|_[u.charCodeAt(E+3)],m[C++]=255&h>>16,m[C++]=255&h>>8,m[C++]=255&h;return M===2&&(h=_[u.charCodeAt(E)]<<2|_[u.charCodeAt(E+1)]>>4,m[C++]=255&h),M===1&&(h=_[u.charCodeAt(E)]<<10|_[u.charCodeAt(E+1)]<<4|_[u.charCodeAt(E+2)]>>2,m[C++]=255&h>>8,m[C++]=255&h),m}function r(u){return a[63&u>>18]+a[63&u>>12]+a[63&u>>6]+a[63&u]}function c(u,h,E){for(var d,R=[],M=h;M<E;M+=3)d=(16711680&u[M]<<16)+(65280&u[M+1]<<8)+(255&u[M+2]),R.push(r(d));return R.join("")}function p(u){for(var h,E=u.length,d=E%3,R=[],M=16383,m=0,C=E-d;m<C;m+=M)R.push(c(u,m,m+M>C?C:m+M));return d===1?(h=u[E-1],R.push(a[h>>2]+a[63&h<<4]+"==")):d===2&&(h=(u[E-2]<<8)+u[E-1],R.push(a[h>>10]+a[63&h>>4]+a[63&h<<2]+"=")),R.join("")}b.byteLength=function(u){var h=o(u),E=h[0],d=h[1];return 3*(E+d)/4-d},b.toByteArray=D,b.fromByteArray=p;for(var a=[],_=[],N=typeof Uint8Array>"u"?Array:Uint8Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=0,i=A.length;P<i;++P)a[P]=A[P],_[A.charCodeAt(P)]=P;_[45]=62,_[95]=63},{}],2:[function(){},{}],3:[function(y,k,b){(function(){(function(){var o=String.fromCharCode,T=Math.min;function D(e){if(2147483647<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=r.prototype,t}function r(e,t,n){if(typeof e=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _(e)}return c(e,t,n)}function c(e,t,n){if(typeof e=="string")return N(e,t);if(ArrayBuffer.isView(e))return A(e);if(e==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(S(e,ArrayBuffer)||e&&S(e.buffer,ArrayBuffer))return P(e,t,n);if(typeof e=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var f=e.valueOf&&e.valueOf();if(f!=null&&f!==e)return r.from(f,t,n);var v=i(e);if(v)return v;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof e[Symbol.toPrimitive]=="function")return r.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function p(e){if(typeof e!="number")throw new TypeError('"size" argument must be of type number');if(0>e)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function a(e,t,n){return p(e),0>=e||t===void 0?D(e):typeof n=="string"?D(e).fill(t,n):D(e).fill(t)}function _(e){return p(e),D(0>e?0:0|u(e))}function N(e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!r.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|h(e,t),f=D(n),v=f.write(e,t);return v!==n&&(f=f.slice(0,v)),f}function A(e){for(var t=0>e.length?0:0|u(e.length),n=D(t),f=0;f<t;f+=1)n[f]=255&e[f];return n}function P(e,t,n){if(0>t||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var f;return f=t===void 0&&n===void 0?new Uint8Array(e):n===void 0?new Uint8Array(e,t):new Uint8Array(e,t,n),f.__proto__=r.prototype,f}function i(e){if(r.isBuffer(e)){var t=0|u(e.length),n=D(t);return n.length===0||e.copy(n,0,0,t),n}return e.length===void 0?e.type==="Buffer"&&Array.isArray(e.data)?A(e.data):void 0:typeof e.length!="number"||I(e.length)?D(0):A(e)}function u(e){if(e>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function h(e,t){if(r.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||S(e,ArrayBuffer))return e.byteLength;if(typeof e!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,f=2<arguments.length&&arguments[2]===!0;if(!f&&n===0)return 0;for(var v=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return me(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ae(e).length;default:if(v)return f?-1:me(e).length;t=(""+t).toLowerCase(),v=!0}}function E(e,t,n){var f=!1;if((t===void 0||0>t)&&(t=0),t>this.length||((n===void 0||n>this.length)&&(n=this.length),0>=n)||(n>>>=0,t>>>=0,n<=t))return"";for(e||(e="utf8");;)switch(e){case"hex":return se(this,t,n);case"utf8":case"utf-8":return Q(this,t,n);case"ascii":return W(this,t,n);case"latin1":case"binary":return Ee(this,t,n);case"base64":return $(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return fe(this,t,n);default:if(f)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),f=!0}}function d(e,t,n){var f=e[t];e[t]=e[n],e[n]=f}function R(e,t,n,f,v){if(e.length===0)return-1;if(typeof n=="string"?(f=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,I(n)&&(n=v?0:e.length-1),0>n&&(n=e.length+n),n>=e.length){if(v)return-1;n=e.length-1}else if(0>n)if(v)n=0;else return-1;if(typeof t=="string"&&(t=r.from(t,f)),r.isBuffer(t))return t.length===0?-1:M(e,t,n,f,v);if(typeof t=="number")return t&=255,typeof Uint8Array.prototype.indexOf=="function"?v?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):M(e,[t],n,f,v);throw new TypeError("val must be string, number or Buffer")}function M(e,t,n,f,v){function L(Ce,Ie){return j===1?Ce[Ie]:Ce.readUInt16BE(Ie*j)}var j=1,z=e.length,J=t.length;if(f!==void 0&&(f=(f+"").toLowerCase(),f==="ucs2"||f==="ucs-2"||f==="utf16le"||f==="utf-16le")){if(2>e.length||2>t.length)return-1;j=2,z/=2,J/=2,n/=2}var G;if(v){var Y=-1;for(G=n;G<z;G++)if(L(e,G)!==L(t,Y===-1?0:G-Y))Y!==-1&&(G-=G-Y),Y=-1;else if(Y===-1&&(Y=G),G-Y+1===J)return Y*j}else for(n+J>z&&(n=z-J),G=n;0<=G;G--){for(var ee=!0,_e=0;_e<J;_e++)if(L(e,G+_e)!==L(t,_e)){ee=!1;break}if(ee)return G}return-1}function m(e,t,n,f){n=+n||0;var v=e.length-n;f?(f=+f,f>v&&(f=v)):f=v;var L=t.length;f>L/2&&(f=L/2);for(var j,z=0;z<f;++z){if(j=parseInt(t.substr(2*z,2),16),I(j))return z;e[n+z]=j}return z}function C(e,t,n,f){return ce(me(t,e.length-n),e,n,f)}function U(e,t,n,f){return ce(Ae(t),e,n,f)}function F(e,t,n,f){return U(e,t,n,f)}function H(e,t,n,f){return ce(ae(t),e,n,f)}function V(e,t,n,f){return ce(ge(t,e.length-n),e,n,f)}function $(e,t,n){return t===0&&n===e.length?B.fromByteArray(e):B.fromByteArray(e.slice(t,n))}function Q(e,t,n){n=T(e.length,n);for(var f=[],v=t;v<n;){var L=e[v],j=null,z=239<L?4:223<L?3:191<L?2:1;if(v+z<=n){var J,G,Y,ee;z===1?128>L&&(j=L):z===2?(J=e[v+1],(192&J)==128&&(ee=(31&L)<<6|63&J,127<ee&&(j=ee))):z===3?(J=e[v+1],G=e[v+2],(192&J)==128&&(192&G)==128&&(ee=(15&L)<<12|(63&J)<<6|63&G,2047<ee&&(55296>ee||57343<ee)&&(j=ee))):z===4&&(J=e[v+1],G=e[v+2],Y=e[v+3],(192&J)==128&&(192&G)==128&&(192&Y)==128&&(ee=(15&L)<<18|(63&J)<<12|(63&G)<<6|63&Y,65535<ee&&1114112>ee&&(j=ee)))}j===null?(j=65533,z=1):65535<j&&(j-=65536,f.push(55296|1023&j>>>10),j=56320|1023&j),f.push(j),v+=z}return te(f)}function te(e){var t=e.length;if(t<=4096)return o.apply(String,e);for(var n="",f=0;f<t;)n+=o.apply(String,e.slice(f,f+=4096));return n}function W(e,t,n){var f="";n=T(e.length,n);for(var v=t;v<n;++v)f+=o(127&e[v]);return f}function Ee(e,t,n){var f="";n=T(e.length,n);for(var v=t;v<n;++v)f+=o(e[v]);return f}function se(e,t,n){var f=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>f)&&(n=f);for(var v="",L=t;L<n;++L)v+=be(e[L]);return v}function fe(e,t,n){for(var f=e.slice(t,n),v="",L=0;L<f.length;L+=2)v+=o(f[L]+256*f[L+1]);return v}function X(e,t,n){if(e%1!=0||0>e)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function K(e,t,n,f,v,L){if(!r.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>v||t<L)throw new RangeError('"value" argument is out of bounds');if(n+f>e.length)throw new RangeError("Index out of range")}function oe(e,t,n,f){if(n+f>e.length)throw new RangeError("Index out of range");if(0>n)throw new RangeError("Index out of range")}function de(e,t,n,f,v){return t=+t,n>>>=0,v||oe(e,t,n,4),q.write(e,t,n,f,23,4),n+4}function pe(e,t,n,f,v){return t=+t,n>>>=0,v||oe(e,t,n,8),q.write(e,t,n,f,52,8),n+8}function ke(e){if(e=e.split("=")[0],e=e.trim().replace(s,""),2>e.length)return"";for(;e.length%4!=0;)e+="=";return e}function be(e){return 16>e?"0"+e.toString(16):e.toString(16)}function me(e,t){t=t||1/0;for(var n,f=e.length,v=null,L=[],j=0;j<f;++j){if(n=e.charCodeAt(j),55295<n&&57344>n){if(!v){if(56319<n){-1<(t-=3)&&L.push(239,191,189);continue}else if(j+1===f){-1<(t-=3)&&L.push(239,191,189);continue}v=n;continue}if(56320>n){-1<(t-=3)&&L.push(239,191,189),v=n;continue}n=(v-55296<<10|n-56320)+65536}else v&&-1<(t-=3)&&L.push(239,191,189);if(v=null,128>n){if(0>(t-=1))break;L.push(n)}else if(2048>n){if(0>(t-=2))break;L.push(192|n>>6,128|63&n)}else if(65536>n){if(0>(t-=3))break;L.push(224|n>>12,128|63&n>>6,128|63&n)}else if(1114112>n){if(0>(t-=4))break;L.push(240|n>>18,128|63&n>>12,128|63&n>>6,128|63&n)}else throw new Error("Invalid code point")}return L}function Ae(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function ge(e,t){for(var n,f,v,L=[],j=0;j<e.length&&!(0>(t-=2));++j)n=e.charCodeAt(j),f=n>>8,v=n%256,L.push(v),L.push(f);return L}function ae(e){return B.toByteArray(ke(e))}function ce(e,t,n,f){for(var v=0;v<f&&!(v+n>=t.length||v>=e.length);++v)t[v+n]=e[v];return v}function S(e,t){return e instanceof t||e!=null&&e.constructor!=null&&e.constructor.name!=null&&e.constructor.name===t.name}function I(e){return e!==e}var B=y("base64-js"),q=y("ieee754");b.Buffer=r,b.SlowBuffer=function(e){return+e!=e&&(e=0),r.alloc(+e)},b.INSPECT_MAX_BYTES=50,b.kMaxLength=2147483647,r.TYPED_ARRAY_SUPPORT=(function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},e.foo()===42}catch{return!1}})(),r.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){return r.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){return r.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&r[Symbol.species]===r&&Object.defineProperty(r,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),r.poolSize=8192,r.from=function(e,t,n){return c(e,t,n)},r.prototype.__proto__=Uint8Array.prototype,r.__proto__=Uint8Array,r.alloc=function(e,t,n){return a(e,t,n)},r.allocUnsafe=function(e){return _(e)},r.allocUnsafeSlow=function(e){return _(e)},r.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==r.prototype},r.compare=function(e,t){if(S(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),S(t,Uint8Array)&&(t=r.from(t,t.offset,t.byteLength)),!r.isBuffer(e)||!r.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,f=t.length,v=0,L=T(n,f);v<L;++v)if(e[v]!==t[v]){n=e[v],f=t[v];break}return n<f?-1:f<n?1:0},r.isEncoding=function(e){switch((e+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return r.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var f=r.allocUnsafe(t),v=0;for(n=0;n<e.length;++n){var L=e[n];if(S(L,Uint8Array)&&(L=r.from(L)),!r.isBuffer(L))throw new TypeError('"list" argument must be an Array of Buffers');L.copy(f,v),v+=L.length}return f},r.byteLength=h,r.prototype._isBuffer=!0,r.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},r.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},r.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},r.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?Q(this,0,e):E.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||r.compare(this,e)===0},r.prototype.inspect=function(){var e="",t=b.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r.prototype.compare=function(e,t,n,f,v){if(S(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),!r.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),f===void 0&&(f=0),v===void 0&&(v=this.length),0>t||n>e.length||0>f||v>this.length)throw new RangeError("out of range index");if(f>=v&&t>=n)return 0;if(f>=v)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,f>>>=0,v>>>=0,this===e)return 0;for(var L=v-f,j=n-t,z=T(L,j),J=this.slice(f,v),G=e.slice(t,n),Y=0;Y<z;++Y)if(J[Y]!==G[Y]){L=J[Y],j=G[Y];break}return L<j?-1:j<L?1:0},r.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},r.prototype.indexOf=function(e,t,n){return R(this,e,t,n,!0)},r.prototype.lastIndexOf=function(e,t,n){return R(this,e,t,n,!1)},r.prototype.write=function(e,t,n,f){if(t===void 0)f="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")f=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,f===void 0&&(f="utf8")):(f=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var v=this.length-t;if((n===void 0||n>v)&&(n=v),0<e.length&&(0>n||0>t)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");f||(f="utf8");for(var L=!1;;)switch(f){case"hex":return m(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return U(this,e,t,n);case"latin1":case"binary":return F(this,e,t,n);case"base64":return H(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,e,t,n);default:if(L)throw new TypeError("Unknown encoding: "+f);f=(""+f).toLowerCase(),L=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},r.prototype.slice=function(e,t){var n=this.length;e=~~e,t=t===void 0?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),t<e&&(t=e);var f=this.subarray(e,t);return f.__proto__=r.prototype,f},r.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||X(e,t,this.length);for(var f=this[e],v=1,L=0;++L<t&&(v*=256);)f+=this[e+L]*v;return f},r.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||X(e,t,this.length);for(var f=this[e+--t],v=1;0<t&&(v*=256);)f+=this[e+--t]*v;return f},r.prototype.readUInt8=function(e,t){return e>>>=0,t||X(e,1,this.length),this[e]},r.prototype.readUInt16LE=function(e,t){return e>>>=0,t||X(e,2,this.length),this[e]|this[e+1]<<8},r.prototype.readUInt16BE=function(e,t){return e>>>=0,t||X(e,2,this.length),this[e]<<8|this[e+1]},r.prototype.readUInt32LE=function(e,t){return e>>>=0,t||X(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},r.prototype.readUInt32BE=function(e,t){return e>>>=0,t||X(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},r.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||X(e,t,this.length);for(var f=this[e],v=1,L=0;++L<t&&(v*=256);)f+=this[e+L]*v;return v*=128,f>=v&&(f-=x(2,8*t)),f},r.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||X(e,t,this.length);for(var f=t,v=1,L=this[e+--f];0<f&&(v*=256);)L+=this[e+--f]*v;return v*=128,L>=v&&(L-=x(2,8*t)),L},r.prototype.readInt8=function(e,t){return e>>>=0,t||X(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},r.prototype.readInt16LE=function(e,t){e>>>=0,t||X(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt16BE=function(e,t){e>>>=0,t||X(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt32LE=function(e,t){return e>>>=0,t||X(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},r.prototype.readInt32BE=function(e,t){return e>>>=0,t||X(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},r.prototype.readFloatLE=function(e,t){return e>>>=0,t||X(e,4,this.length),q.read(this,e,!0,23,4)},r.prototype.readFloatBE=function(e,t){return e>>>=0,t||X(e,4,this.length),q.read(this,e,!1,23,4)},r.prototype.readDoubleLE=function(e,t){return e>>>=0,t||X(e,8,this.length),q.read(this,e,!0,52,8)},r.prototype.readDoubleBE=function(e,t){return e>>>=0,t||X(e,8,this.length),q.read(this,e,!1,52,8)},r.prototype.writeUIntLE=function(e,t,n,f){if(e=+e,t>>>=0,n>>>=0,!f){var v=x(2,8*n)-1;K(this,e,t,n,v,0)}var L=1,j=0;for(this[t]=255&e;++j<n&&(L*=256);)this[t+j]=255&e/L;return t+n},r.prototype.writeUIntBE=function(e,t,n,f){if(e=+e,t>>>=0,n>>>=0,!f){var v=x(2,8*n)-1;K(this,e,t,n,v,0)}var L=n-1,j=1;for(this[t+L]=255&e;0<=--L&&(j*=256);)this[t+L]=255&e/j;return t+n},r.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,1,255,0),this[t]=255&e,t+1},r.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},r.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeIntLE=function(e,t,n,f){if(e=+e,t>>>=0,!f){var v=x(2,8*n-1);K(this,e,t,n,v-1,-v)}var L=0,j=1,z=0;for(this[t]=255&e;++L<n&&(j*=256);)0>e&&z===0&&this[t+L-1]!==0&&(z=1),this[t+L]=255&(e/j>>0)-z;return t+n},r.prototype.writeIntBE=function(e,t,n,f){if(e=+e,t>>>=0,!f){var v=x(2,8*n-1);K(this,e,t,n,v-1,-v)}var L=n-1,j=1,z=0;for(this[t+L]=255&e;0<=--L&&(j*=256);)0>e&&z===0&&this[t+L+1]!==0&&(z=1),this[t+L]=255&(e/j>>0)-z;return t+n},r.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,1,127,-128),0>e&&(e=255+e+1),this[t]=255&e,t+1},r.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},r.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||K(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeFloatLE=function(e,t,n){return de(this,e,t,!0,n)},r.prototype.writeFloatBE=function(e,t,n){return de(this,e,t,!1,n)},r.prototype.writeDoubleLE=function(e,t,n){return pe(this,e,t,!0,n)},r.prototype.writeDoubleBE=function(e,t,n){return pe(this,e,t,!1,n)},r.prototype.copy=function(e,t,n,f){if(!r.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),f||f===0||(f=this.length),t>=e.length&&(t=e.length),t||(t=0),0<f&&f<n&&(f=n),f===n||e.length===0||this.length===0)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("Index out of range");if(0>f)throw new RangeError("sourceEnd out of bounds");f>this.length&&(f=this.length),e.length-t<f-n&&(f=e.length-t+n);var v=f-n;if(this===e&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(t,n,f);else if(this===e&&n<t&&t<f)for(var L=v-1;0<=L;--L)e[L+t]=this[L+n];else Uint8Array.prototype.set.call(e,this.subarray(n,f),t);return v},r.prototype.fill=function(e,t,n,f){if(typeof e=="string"){if(typeof t=="string"?(f=t,t=0,n=this.length):typeof n=="string"&&(f=n,n=this.length),f!==void 0&&typeof f!="string")throw new TypeError("encoding must be a string");if(typeof f=="string"&&!r.isEncoding(f))throw new TypeError("Unknown encoding: "+f);if(e.length===1){var v=e.charCodeAt(0);(f==="utf8"&&128>v||f==="latin1")&&(e=v)}}else typeof e=="number"&&(e&=255);if(0>t||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=n===void 0?this.length:n>>>0,e||(e=0);var L;if(typeof e=="number")for(L=t;L<n;++L)this[L]=e;else{var j=r.isBuffer(e)?e:r.from(e,f),z=j.length;if(z===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(L=0;L<n-t;++L)this[L+t]=j[L%z]}return this};var s=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,y("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(y,k,b){(function(o){(function(){function T(){let r;try{r=b.storage.getItem("debug")}catch{}return!r&&typeof o<"u"&&"env"in o&&(r=o.env.DEBUG),r}b.formatArgs=function(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+k.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;r.splice(1,0,c,"color: inherit");let p=0,a=0;r[0].replace(/%[a-zA-Z%]/g,_=>{_==="%%"||(p++,_==="%c"&&(a=p))}),r.splice(a,0,c)},b.save=function(r){try{r?b.storage.setItem("debug",r):b.storage.removeItem("debug")}catch{}},b.load=T,b.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},b.storage=(function(){try{return localStorage}catch{}})(),b.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),b.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],b.log=console.debug||console.log||(()=>{}),k.exports=y("./common")(b);const{formatters:D}=k.exports;D.j=function(r){try{return JSON.stringify(r)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}}).call(this)}).call(this,y("_process"))},{"./common":5,_process:12}],5:[function(y,k){k.exports=function(b){function o(r){function c(..._){if(!c.enabled)return;const N=c,A=+new Date,P=A-(p||A);N.diff=P,N.prev=p,N.curr=A,p=A,_[0]=o.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let i=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(h,E)=>{if(h==="%%")return"%";i++;const d=o.formatters[E];if(typeof d=="function"){const R=_[i];h=d.call(N,R),_.splice(i,1),i--}return h}),o.formatArgs.call(N,_),(N.log||o.log).apply(N,_)}let p,a=null;return c.namespace=r,c.useColors=o.useColors(),c.color=o.selectColor(r),c.extend=T,c.destroy=o.destroy,Object.defineProperty(c,"enabled",{enumerable:!0,configurable:!1,get:()=>a===null?o.enabled(r):a,set:_=>{a=_}}),typeof o.init=="function"&&o.init(c),c}function T(r,c){const p=o(this.namespace+(typeof c>"u"?":":c)+r);return p.log=this.log,p}function D(r){return r.toString().substring(2,r.toString().length-2).replace(/\.\*\?$/,"*")}return o.debug=o,o.default=o,o.coerce=function(r){return r instanceof Error?r.stack||r.message:r},o.disable=function(){const r=[...o.names.map(D),...o.skips.map(D).map(c=>"-"+c)].join(",");return o.enable(""),r},o.enable=function(r){o.save(r),o.names=[],o.skips=[];let c;const p=(typeof r=="string"?r:"").split(/[\s,]+/),a=p.length;for(c=0;c<a;c++)p[c]&&(r=p[c].replace(/\*/g,".*?"),r[0]==="-"?o.skips.push(new RegExp("^"+r.substr(1)+"$")):o.names.push(new RegExp("^"+r+"$")))},o.enabled=function(r){if(r[r.length-1]==="*")return!0;let c,p;for(c=0,p=o.skips.length;c<p;c++)if(o.skips[c].test(r))return!1;for(c=0,p=o.names.length;c<p;c++)if(o.names[c].test(r))return!0;return!1},o.humanize=y("ms"),o.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(b).forEach(r=>{o[r]=b[r]}),o.names=[],o.skips=[],o.formatters={},o.selectColor=function(r){let c=0;for(let p=0;p<r.length;p++)c=(c<<5)-c+r.charCodeAt(p),c|=0;return o.colors[O(c)%o.colors.length]},o.enable(o.load()),o}},{ms:11}],6:[function(y,k){function b(o,T){for(const D in T)Object.defineProperty(o,D,{value:T[D],enumerable:!0,configurable:!0});return o}k.exports=function(o,T,D){if(!o||typeof o=="string")throw new TypeError("Please pass an Error to err-code");D||(D={}),typeof T=="object"&&(D=T,T=""),T&&(D.code=T);try{return b(o,D)}catch{D.message=o.message,D.stack=o.stack;const c=function(){};return c.prototype=Object.create(Object.getPrototypeOf(o)),b(new c,D)}}},{}],7:[function(y,k){function b(m){console&&console.warn&&console.warn(m)}function o(){o.init.call(this)}function T(m){if(typeof m!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof m)}function D(m){return m._maxListeners===void 0?o.defaultMaxListeners:m._maxListeners}function r(m,C,U,F){var H,V,$;if(T(U),V=m._events,V===void 0?(V=m._events=Object.create(null),m._eventsCount=0):(V.newListener!==void 0&&(m.emit("newListener",C,U.listener?U.listener:U),V=m._events),$=V[C]),$===void 0)$=V[C]=U,++m._eventsCount;else if(typeof $=="function"?$=V[C]=F?[U,$]:[$,U]:F?$.unshift(U):$.push(U),H=D(m),0<H&&$.length>H&&!$.warned){$.warned=!0;var Q=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+(C+" listeners added. Use emitter.setMaxListeners() to increase limit"));Q.name="MaxListenersExceededWarning",Q.emitter=m,Q.type=C,Q.count=$.length,b(Q)}return m}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(m,C,U){var F={fired:!1,wrapFn:void 0,target:m,type:C,listener:U},H=c.bind(F);return H.listener=U,F.wrapFn=H,H}function a(m,C,U){var F=m._events;if(F===void 0)return[];var H=F[C];return H===void 0?[]:typeof H=="function"?U?[H.listener||H]:[H]:U?P(H):N(H,H.length)}function _(m){var C=this._events;if(C!==void 0){var U=C[m];if(typeof U=="function")return 1;if(U!==void 0)return U.length}return 0}function N(m,C){for(var U=Array(C),F=0;F<C;++F)U[F]=m[F];return U}function A(m,C){for(;C+1<m.length;C++)m[C]=m[C+1];m.pop()}function P(m){for(var C=Array(m.length),U=0;U<C.length;++U)C[U]=m[U].listener||m[U];return C}function i(m,C,U){typeof m.on=="function"&&u(m,"error",C,U)}function u(m,C,U,F){if(typeof m.on=="function")F.once?m.once(C,U):m.on(C,U);else if(typeof m.addEventListener=="function")m.addEventListener(C,function H(V){F.once&&m.removeEventListener(C,H),U(V)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof m)}var h,E=typeof Reflect=="object"?Reflect:null,d=E&&typeof E.apply=="function"?E.apply:function(m,C,U){return Function.prototype.apply.call(m,C,U)};h=E&&typeof E.ownKeys=="function"?E.ownKeys:Object.getOwnPropertySymbols?function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:function(m){return Object.getOwnPropertyNames(m)};var R=Number.isNaN||function(m){return m!==m};k.exports=o,k.exports.once=function(m,C){return new Promise(function(U,F){function H($){m.removeListener(C,V),F($)}function V(){typeof m.removeListener=="function"&&m.removeListener("error",H),U([].slice.call(arguments))}u(m,C,V,{once:!0}),C!=="error"&&i(m,H,{once:!0})})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var M=10;Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(m){if(typeof m!="number"||0>m||R(m))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+m+".");M=m}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(m){if(typeof m!="number"||0>m||R(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this},o.prototype.getMaxListeners=function(){return D(this)},o.prototype.emit=function(m){for(var C=[],U=1;U<arguments.length;U++)C.push(arguments[U]);var F=m==="error",H=this._events;if(H!==void 0)F=F&&H.error===void 0;else if(!F)return!1;if(F){var V;if(0<C.length&&(V=C[0]),V instanceof Error)throw V;var $=new Error("Unhandled error."+(V?" ("+V.message+")":""));throw $.context=V,$}var Q=H[m];if(Q===void 0)return!1;if(typeof Q=="function")d(Q,this,C);else for(var te=Q.length,W=N(Q,te),U=0;U<te;++U)d(W[U],this,C);return!0},o.prototype.addListener=function(m,C){return r(this,m,C,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(m,C){return r(this,m,C,!0)},o.prototype.once=function(m,C){return T(C),this.on(m,p(this,m,C)),this},o.prototype.prependOnceListener=function(m,C){return T(C),this.prependListener(m,p(this,m,C)),this},o.prototype.removeListener=function(m,C){var U,F,H,V,$;if(T(C),F=this._events,F===void 0)return this;if(U=F[m],U===void 0)return this;if(U===C||U.listener===C)--this._eventsCount==0?this._events=Object.create(null):(delete F[m],F.removeListener&&this.emit("removeListener",m,U.listener||C));else if(typeof U!="function"){for(H=-1,V=U.length-1;0<=V;V--)if(U[V]===C||U[V].listener===C){$=U[V].listener,H=V;break}if(0>H)return this;H===0?U.shift():A(U,H),U.length===1&&(F[m]=U[0]),F.removeListener!==void 0&&this.emit("removeListener",m,$||C)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(m){var C,U,F;if(U=this._events,U===void 0)return this;if(U.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):U[m]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete U[m]),this;if(arguments.length===0){var H,V=Object.keys(U);for(F=0;F<V.length;++F)H=V[F],H!=="removeListener"&&this.removeAllListeners(H);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=U[m],typeof C=="function")this.removeListener(m,C);else if(C!==void 0)for(F=C.length-1;0<=F;F--)this.removeListener(m,C[F]);return this},o.prototype.listeners=function(m){return a(this,m,!0)},o.prototype.rawListeners=function(m){return a(this,m,!1)},o.listenerCount=function(m,C){return typeof m.listenerCount=="function"?m.listenerCount(C):_.call(m,C)},o.prototype.listenerCount=_,o.prototype.eventNames=function(){return 0<this._eventsCount?h(this._events):[]}},{}],8:[function(y,k){k.exports=function(){if(typeof globalThis>"u")return null;var b={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return b.RTCPeerConnection?b:null}},{}],9:[function(y,k,b){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */b.read=function(o,T,D,r,c){var p,a,_=8*c-r-1,N=(1<<_)-1,A=N>>1,P=-7,i=D?c-1:0,u=D?-1:1,h=o[T+i];for(i+=u,p=h&(1<<-P)-1,h>>=-P,P+=_;0<P;p=256*p+o[T+i],i+=u,P-=8);for(a=p&(1<<-P)-1,p>>=-P,P+=r;0<P;a=256*a+o[T+i],i+=u,P-=8);if(p===0)p=1-A;else{if(p===N)return a?NaN:(h?-1:1)*(1/0);a+=x(2,r),p-=A}return(h?-1:1)*a*x(2,p-r)},b.write=function(o,T,D,r,c,p){var a,_,N,A=Math.LN2,P=Math.log,i=8*p-c-1,u=(1<<i)-1,h=u>>1,E=c===23?x(2,-24)-x(2,-77):0,d=r?0:p-1,R=r?1:-1,M=0>T||T===0&&0>1/T?1:0;for(T=O(T),isNaN(T)||T===1/0?(_=isNaN(T)?1:0,a=u):(a=g(P(T)/A),1>T*(N=x(2,-a))&&(a--,N*=2),T+=1<=a+h?E/N:E*x(2,1-h),2<=T*N&&(a++,N/=2),a+h>=u?(_=0,a=u):1<=a+h?(_=(T*N-1)*x(2,c),a+=h):(_=T*x(2,h-1)*x(2,c),a=0));8<=c;o[D+d]=255&_,d+=R,_/=256,c-=8);for(a=a<<c|_,i+=c;0<i;o[D+d]=255&a,d+=R,a/=256,i-=8);o[D+d-R]|=128*M}},{}],10:[function(y,k){k.exports=typeof Object.create=="function"?function(b,o){o&&(b.super_=o,b.prototype=Object.create(o.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}))}:function(b,o){if(o){b.super_=o;var T=function(){};T.prototype=o.prototype,b.prototype=new T,b.prototype.constructor=b}}},{}],11:[function(y,k){var b=Math.round;function o(c){if(c+="",!(100<c.length)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(p){var a=parseFloat(p[1]),_=(p[2]||"ms").toLowerCase();return _==="years"||_==="year"||_==="yrs"||_==="yr"||_==="y"?315576e5*a:_==="weeks"||_==="week"||_==="w"?6048e5*a:_==="days"||_==="day"||_==="d"?864e5*a:_==="hours"||_==="hour"||_==="hrs"||_==="hr"||_==="h"?36e5*a:_==="minutes"||_==="minute"||_==="mins"||_==="min"||_==="m"?6e4*a:_==="seconds"||_==="second"||_==="secs"||_==="sec"||_==="s"?1e3*a:_==="milliseconds"||_==="millisecond"||_==="msecs"||_==="msec"||_==="ms"?a:void 0}}}function T(c){var p=O(c);return 864e5<=p?b(c/864e5)+"d":36e5<=p?b(c/36e5)+"h":6e4<=p?b(c/6e4)+"m":1e3<=p?b(c/1e3)+"s":c+"ms"}function D(c){var p=O(c);return 864e5<=p?r(c,p,864e5,"day"):36e5<=p?r(c,p,36e5,"hour"):6e4<=p?r(c,p,6e4,"minute"):1e3<=p?r(c,p,1e3,"second"):c+" ms"}function r(c,p,a,_){return b(c/a)+" "+_+(p>=1.5*a?"s":"")}k.exports=function(c,p){p=p||{};var a=typeof c;if(a=="string"&&0<c.length)return o(c);if(a==="number"&&isFinite(c))return p.long?D(c):T(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))}},{}],12:[function(y,k){function b(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function T(E){if(_===setTimeout)return setTimeout(E,0);if((_===b||!_)&&setTimeout)return _=setTimeout,setTimeout(E,0);try{return _(E,0)}catch{try{return _.call(null,E,0)}catch{return _.call(this,E,0)}}}function D(E){if(N===clearTimeout)return clearTimeout(E);if((N===o||!N)&&clearTimeout)return N=clearTimeout,clearTimeout(E);try{return N(E)}catch{try{return N.call(null,E)}catch{return N.call(this,E)}}}function r(){u&&P&&(u=!1,P.length?i=P.concat(i):h=-1,i.length&&c())}function c(){if(!u){var E=T(r);u=!0;for(var d=i.length;d;){for(P=i,i=[];++h<d;)P&&P[h].run();h=-1,d=i.length}P=null,u=!1,D(E)}}function p(E,d){this.fun=E,this.array=d}function a(){}var _,N,A=k.exports={};(function(){try{_=typeof setTimeout=="function"?setTimeout:b}catch{_=b}try{N=typeof clearTimeout=="function"?clearTimeout:o}catch{N=o}})();var P,i=[],u=!1,h=-1;A.nextTick=function(E){var d=Array(arguments.length-1);if(1<arguments.length)for(var R=1;R<arguments.length;R++)d[R-1]=arguments[R];i.push(new p(E,d)),i.length!==1||u||T(c)},p.prototype.run=function(){this.fun.apply(null,this.array)},A.title="browser",A.browser=!0,A.env={},A.argv=[],A.version="",A.versions={},A.on=a,A.addListener=a,A.once=a,A.off=a,A.removeListener=a,A.removeAllListeners=a,A.emit=a,A.prependListener=a,A.prependOnceListener=a,A.listeners=function(){return[]},A.binding=function(){throw new Error("process.binding is not supported")},A.cwd=function(){return"/"},A.chdir=function(){throw new Error("process.chdir is not supported")},A.umask=function(){return 0}},{}],13:[function(y,k){(function(b){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let o;k.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?b:window):T=>(o||(o=Promise.resolve())).then(T).catch(D=>setTimeout(()=>{throw D},0))}).call(this)}).call(this,typeof le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:le)},{}],14:[function(y,k){(function(b,o){(function(){var T=y("safe-buffer").Buffer,D=o.crypto||o.msCrypto;k.exports=D&&D.getRandomValues?function(r,c){if(r>4294967295)throw new RangeError("requested too many random bytes");var p=T.allocUnsafe(r);if(0<r)if(65536<r)for(var a=0;a<r;a+=65536)D.getRandomValues(p.slice(a,a+65536));else D.getRandomValues(p);return typeof c=="function"?b.nextTick(function(){c(null,p)}):p}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,y("_process"),typeof le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:le)},{_process:12,"safe-buffer":30}],15:[function(y,k){function b(a,_){a.prototype=Object.create(_.prototype),a.prototype.constructor=a,a.__proto__=_}function o(a,_,N){function A(i,u,h){return typeof _=="string"?_:_(i,u,h)}N||(N=Error);var P=(function(i){function u(h,E,d){return i.call(this,A(h,E,d))||this}return b(u,i),u})(N);P.prototype.name=N.name,P.prototype.code=a,p[a]=P}function T(a,_){if(Array.isArray(a)){var N=a.length;return a=a.map(function(A){return A+""}),2<N?"one of ".concat(_," ").concat(a.slice(0,N-1).join(", "),", or ")+a[N-1]:N===2?"one of ".concat(_," ").concat(a[0]," or ").concat(a[1]):"of ".concat(_," ").concat(a[0])}return"of ".concat(_," ").concat(a+"")}function D(a,_,N){return a.substr(0,_.length)===_}function r(a,_,N){return(N===void 0||N>a.length)&&(N=a.length),a.substring(N-_.length,N)===_}function c(a,_,N){return typeof N!="number"&&(N=0),!(N+_.length>a.length)&&a.indexOf(_,N)!==-1}var p={};o("ERR_INVALID_OPT_VALUE",function(a,_){return'The value "'+_+'" is invalid for option "'+a+'"'},TypeError),o("ERR_INVALID_ARG_TYPE",function(a,_,N){var A;typeof _=="string"&&D(_,"not ")?(A="must not be",_=_.replace(/^not /,"")):A="must be";var P;if(r(a," argument"))P="The ".concat(a," ").concat(A," ").concat(T(_,"type"));else{var i=c(a,".")?"property":"argument";P='The "'.concat(a,'" ').concat(i," ").concat(A," ").concat(T(_,"type"))}return P+=". Received type ".concat(typeof N),P},TypeError),o("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),o("ERR_METHOD_NOT_IMPLEMENTED",function(a){return"The "+a+" method is not implemented"}),o("ERR_STREAM_PREMATURE_CLOSE","Premature close"),o("ERR_STREAM_DESTROYED",function(a){return"Cannot call "+a+" after a stream was destroyed"}),o("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),o("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),o("ERR_STREAM_WRITE_AFTER_END","write after end"),o("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),o("ERR_UNKNOWN_ENCODING",function(a){return"Unknown encoding: "+a},TypeError),o("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),k.exports.codes=p},{}],16:[function(y,k){(function(b){(function(){function o(A){return this instanceof o?(c.call(this,A),p.call(this,A),this.allowHalfOpen=!0,void(A&&(A.readable===!1&&(this.readable=!1),A.writable===!1&&(this.writable=!1),A.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",T))))):new o(A)}function T(){this._writableState.ended||b.nextTick(D,this)}function D(A){A.end()}var r=Object.keys||function(A){var P=[];for(var i in A)P.push(i);return P};k.exports=o;var c=y("./_stream_readable"),p=y("./_stream_writable");y("inherits")(o,c);for(var a,_=r(p.prototype),N=0;N<_.length;N++)a=_[N],o.prototype[a]||(o.prototype[a]=p.prototype[a]);Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(A){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=A,this._writableState.destroyed=A)}})}).call(this)}).call(this,y("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(y,k){function b(T){return this instanceof b?void o.call(this,T):new b(T)}k.exports=b;var o=y("./_stream_transform");y("inherits")(b,o),b.prototype._transform=function(T,D,r){r(null,T)}},{"./_stream_transform":19,inherits:10}],18:[function(y,k){(function(b,o){(function(){function T(s){return fe.from(s)}function D(s){return fe.isBuffer(s)||s instanceof X}function r(s,e,t){return typeof s.prependListener=="function"?s.prependListener(e,t):void(s._events&&s._events[e]?Array.isArray(s._events[e])?s._events[e].unshift(t):s._events[e]=[t,s._events[e]]:s.on(e,t))}function c(s,e,t){te=te||y("./_stream_duplex"),s=s||{},typeof t!="boolean"&&(t=e instanceof te),this.objectMode=!!s.objectMode,t&&(this.objectMode=this.objectMode||!!s.readableObjectMode),this.highWaterMark=Ae(this,s,"readableHighWaterMark",t),this.buffer=new ke,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=s.emitClose!==!1,this.autoDestroy=!!s.autoDestroy,this.destroyed=!1,this.defaultEncoding=s.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,s.encoding&&(!oe&&(oe=y("string_decoder/").StringDecoder),this.decoder=new oe(s.encoding),this.encoding=s.encoding)}function p(s){if(te=te||y("./_stream_duplex"),!(this instanceof p))return new p(s);var e=this instanceof te;this._readableState=new c(s,this,e),this.readable=!0,s&&(typeof s.read=="function"&&(this._read=s.read),typeof s.destroy=="function"&&(this._destroy=s.destroy)),se.call(this)}function a(s,e,t,n,f){W("readableAddChunk",e);var v=s._readableState;if(e===null)v.reading=!1,i(s,v);else{var L;if(f||(L=N(v,e)),L)B(s,L);else if(!(v.objectMode||e&&0<e.length))n||(v.reading=!1,E(s,v));else if(typeof e=="string"||v.objectMode||Object.getPrototypeOf(e)===fe.prototype||(e=T(e)),n)v.endEmitted?B(s,new I):_(s,v,e,!0);else if(v.ended)B(s,new ce);else{if(v.destroyed)return!1;v.reading=!1,v.decoder&&!t?(e=v.decoder.write(e),v.objectMode||e.length!==0?_(s,v,e,!1):E(s,v)):_(s,v,e,!1)}}return!v.ended&&(v.length<v.highWaterMark||v.length===0)}function _(s,e,t,n){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,s.emit("data",t)):(e.length+=e.objectMode?1:t.length,n?e.buffer.unshift(t):e.buffer.push(t),e.needReadable&&u(s)),E(s,e)}function N(s,e){var t;return D(e)||typeof e=="string"||e===void 0||s.objectMode||(t=new ae("chunk",["string","Buffer","Uint8Array"],e)),t}function A(s){return 1073741824<=s?s=1073741824:(s--,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s++),s}function P(s,e){return 0>=s||e.length===0&&e.ended?0:e.objectMode?1:s===s?(s>e.highWaterMark&&(e.highWaterMark=A(s)),s<=e.length?s:e.ended?e.length:(e.needReadable=!0,0)):e.flowing&&e.length?e.buffer.head.data.length:e.length}function i(s,e){if(W("onEofChunk"),!e.ended){if(e.decoder){var t=e.decoder.end();t&&t.length&&(e.buffer.push(t),e.length+=e.objectMode?1:t.length)}e.ended=!0,e.sync?u(s):(e.needReadable=!1,!e.emittedReadable&&(e.emittedReadable=!0,h(s)))}}function u(s){var e=s._readableState;W("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(W("emitReadable",e.flowing),e.emittedReadable=!0,b.nextTick(h,s))}function h(s){var e=s._readableState;W("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(s.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,F(s)}function E(s,e){e.readingMore||(e.readingMore=!0,b.nextTick(d,s,e))}function d(s,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var t=e.length;if(W("maybeReadMore read 0"),s.read(0),t===e.length)break}e.readingMore=!1}function R(s){return function(){var e=s._readableState;W("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,e.awaitDrain===0&&Ee(s,"data")&&(e.flowing=!0,F(s))}}function M(s){var e=s._readableState;e.readableListening=0<s.listenerCount("readable"),e.resumeScheduled&&!e.paused?e.flowing=!0:0<s.listenerCount("data")&&s.resume()}function m(s){W("readable nexttick read 0"),s.read(0)}function C(s,e){e.resumeScheduled||(e.resumeScheduled=!0,b.nextTick(U,s,e))}function U(s,e){W("resume",e.reading),e.reading||s.read(0),e.resumeScheduled=!1,s.emit("resume"),F(s),e.flowing&&!e.reading&&s.read(0)}function F(s){var e=s._readableState;for(W("flow",e.flowing);e.flowing&&s.read()!==null;);}function H(s,e){if(e.length===0)return null;var t;return e.objectMode?t=e.buffer.shift():!s||s>=e.length?(t=e.decoder?e.buffer.join(""):e.buffer.length===1?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):t=e.buffer.consume(s,e.decoder),t}function V(s){var e=s._readableState;W("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,b.nextTick($,e,s))}function $(s,e){if(W("endReadableNT",s.endEmitted,s.length),!s.endEmitted&&s.length===0&&(s.endEmitted=!0,e.readable=!1,e.emit("end"),s.autoDestroy)){var t=e._writableState;(!t||t.autoDestroy&&t.finished)&&e.destroy()}}function Q(s,e){for(var t=0,n=s.length;t<n;t++)if(s[t]===e)return t;return-1}k.exports=p;var te;p.ReadableState=c;var W;y("events").EventEmitter;var Ee=function(s,e){return s.listeners(e).length},se=y("./internal/streams/stream"),fe=y("buffer").Buffer,X=o.Uint8Array||function(){},K=y("util");W=K&&K.debuglog?K.debuglog("stream"):function(){};var oe,de,pe,ke=y("./internal/streams/buffer_list"),be=y("./internal/streams/destroy"),me=y("./internal/streams/state"),Ae=me.getHighWaterMark,ge=y("../errors").codes,ae=ge.ERR_INVALID_ARG_TYPE,ce=ge.ERR_STREAM_PUSH_AFTER_EOF,S=ge.ERR_METHOD_NOT_IMPLEMENTED,I=ge.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;y("inherits")(p,se);var B=be.errorOrDestroy,q=["error","close","destroy","pause","resume"];Object.defineProperty(p.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(s){this._readableState&&(this._readableState.destroyed=s)}}),p.prototype.destroy=be.destroy,p.prototype._undestroy=be.undestroy,p.prototype._destroy=function(s,e){e(s)},p.prototype.push=function(s,e){var t,n=this._readableState;return n.objectMode?t=!0:typeof s=="string"&&(e=e||n.defaultEncoding,e!==n.encoding&&(s=fe.from(s,e),e=""),t=!0),a(this,s,e,!1,t)},p.prototype.unshift=function(s){return a(this,s,null,!0,!1)},p.prototype.isPaused=function(){return this._readableState.flowing===!1},p.prototype.setEncoding=function(s){oe||(oe=y("string_decoder/").StringDecoder);var e=new oe(s);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var t=this._readableState.buffer.head,n="";t!==null;)n+=e.write(t.data),t=t.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this},p.prototype.read=function(s){W("read",s),s=parseInt(s,10);var e=this._readableState,t=s;if(s!==0&&(e.emittedReadable=!1),s===0&&e.needReadable&&((e.highWaterMark===0?0<e.length:e.length>=e.highWaterMark)||e.ended))return W("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?V(this):u(this),null;if(s=P(s,e),s===0&&e.ended)return e.length===0&&V(this),null;var n=e.needReadable;W("need readable",n),(e.length===0||e.length-s<e.highWaterMark)&&(n=!0,W("length less than watermark",n)),e.ended||e.reading?(n=!1,W("reading or ended",n)):n&&(W("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,!e.reading&&(s=P(t,e)));var f;return f=0<s?H(s,e):null,f===null?(e.needReadable=e.length<=e.highWaterMark,s=0):(e.length-=s,e.awaitDrain=0),e.length===0&&(!e.ended&&(e.needReadable=!0),t!==s&&e.ended&&V(this)),f!==null&&this.emit("data",f),f},p.prototype._read=function(){B(this,new S("_read()"))},p.prototype.pipe=function(s,e){function t(Se,Re){W("onunpipe"),Se===G&&Re&&Re.hasUnpiped===!1&&(Re.hasUnpiped=!0,f())}function n(){W("onend"),s.end()}function f(){W("cleanup"),s.removeListener("close",j),s.removeListener("finish",z),s.removeListener("drain",Ce),s.removeListener("error",L),s.removeListener("unpipe",t),G.removeListener("end",n),G.removeListener("end",J),G.removeListener("data",v),Ie=!0,Y.awaitDrain&&(!s._writableState||s._writableState.needDrain)&&Ce()}function v(Se){W("ondata");var Re=s.write(Se);W("dest.write",Re),Re===!1&&((Y.pipesCount===1&&Y.pipes===s||1<Y.pipesCount&&Q(Y.pipes,s)!==-1)&&!Ie&&(W("false write response, pause",Y.awaitDrain),Y.awaitDrain++),G.pause())}function L(Se){W("onerror",Se),J(),s.removeListener("error",L),Ee(s,"error")===0&&B(s,Se)}function j(){s.removeListener("finish",z),J()}function z(){W("onfinish"),s.removeListener("close",j),J()}function J(){W("unpipe"),G.unpipe(s)}var G=this,Y=this._readableState;switch(Y.pipesCount){case 0:Y.pipes=s;break;case 1:Y.pipes=[Y.pipes,s];break;default:Y.pipes.push(s)}Y.pipesCount+=1,W("pipe count=%d opts=%j",Y.pipesCount,e);var ee=(!e||e.end!==!1)&&s!==b.stdout&&s!==b.stderr,_e=ee?n:J;Y.endEmitted?b.nextTick(_e):G.once("end",_e),s.on("unpipe",t);var Ce=R(G);s.on("drain",Ce);var Ie=!1;return G.on("data",v),r(s,"error",L),s.once("close",j),s.once("finish",z),s.emit("pipe",G),Y.flowing||(W("pipe resume"),G.resume()),s},p.prototype.unpipe=function(s){var e=this._readableState,t={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return s&&s!==e.pipes?this:(s||(s=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,s&&s.emit("unpipe",this,t),this);if(!s){var n=e.pipes,f=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var v=0;v<f;v++)n[v].emit("unpipe",this,{hasUnpiped:!1});return this}var L=Q(e.pipes,s);return L===-1?this:(e.pipes.splice(L,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),s.emit("unpipe",this,t),this)},p.prototype.on=function(s,e){var t=se.prototype.on.call(this,s,e),n=this._readableState;return s==="data"?(n.readableListening=0<this.listenerCount("readable"),n.flowing!==!1&&this.resume()):s=="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,W("on readable",n.length,n.reading),n.length?u(this):!n.reading&&b.nextTick(m,this)),t},p.prototype.addListener=p.prototype.on,p.prototype.removeListener=function(s,e){var t=se.prototype.removeListener.call(this,s,e);return s==="readable"&&b.nextTick(M,this),t},p.prototype.removeAllListeners=function(s){var e=se.prototype.removeAllListeners.apply(this,arguments);return(s==="readable"||s===void 0)&&b.nextTick(M,this),e},p.prototype.resume=function(){var s=this._readableState;return s.flowing||(W("resume"),s.flowing=!s.readableListening,C(this,s)),s.paused=!1,this},p.prototype.pause=function(){return W("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(W("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},p.prototype.wrap=function(s){var e=this,t=this._readableState,n=!1;for(var f in s.on("end",function(){if(W("wrapped end"),t.decoder&&!t.ended){var L=t.decoder.end();L&&L.length&&e.push(L)}e.push(null)}),s.on("data",function(L){if(W("wrapped data"),t.decoder&&(L=t.decoder.write(L)),!(t.objectMode&&L==null)&&(t.objectMode||L&&L.length)){var j=e.push(L);j||(n=!0,s.pause())}}),s)this[f]===void 0&&typeof s[f]=="function"&&(this[f]=(function(L){return function(){return s[L].apply(s,arguments)}})(f));for(var v=0;v<q.length;v++)s.on(q[v],this.emit.bind(this,q[v]));return this._read=function(L){W("wrapped _read",L),n&&(n=!1,s.resume())},this},typeof Symbol=="function"&&(p.prototype[Symbol.asyncIterator]=function(){return de===void 0&&(de=y("./internal/streams/async_iterator")),de(this)}),Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(p.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(p.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(s){this._readableState&&(this._readableState.flowing=s)}}),p._fromList=H,Object.defineProperty(p.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(p.from=function(s,e){return pe===void 0&&(pe=y("./internal/streams/from")),pe(p,s,e)})}).call(this)}).call(this,y("_process"),typeof le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:le)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(y,k){function b(A,P){var i=this._transformState;i.transforming=!1;var u=i.writecb;if(u===null)return this.emit("error",new p);i.writechunk=null,i.writecb=null,P!=null&&this.push(P),u(A);var h=this._readableState;h.reading=!1,(h.needReadable||h.length<h.highWaterMark)&&this._read(h.highWaterMark)}function o(A){return this instanceof o?(N.call(this,A),this._transformState={afterTransform:b.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,A&&(typeof A.transform=="function"&&(this._transform=A.transform),typeof A.flush=="function"&&(this._flush=A.flush)),void this.on("prefinish",T)):new o(A)}function T(){var A=this;typeof this._flush!="function"||this._readableState.destroyed?D(this,null,null):this._flush(function(P,i){D(A,P,i)})}function D(A,P,i){if(P)return A.emit("error",P);if(i!=null&&A.push(i),A._writableState.length)throw new _;if(A._transformState.transforming)throw new a;return A.push(null)}k.exports=o;var r=y("../errors").codes,c=r.ERR_METHOD_NOT_IMPLEMENTED,p=r.ERR_MULTIPLE_CALLBACK,a=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,_=r.ERR_TRANSFORM_WITH_LENGTH_0,N=y("./_stream_duplex");y("inherits")(o,N),o.prototype.push=function(A,P){return this._transformState.needTransform=!1,N.prototype.push.call(this,A,P)},o.prototype._transform=function(A,P,i){i(new c("_transform()"))},o.prototype._write=function(A,P,i){var u=this._transformState;if(u.writecb=i,u.writechunk=A,u.writeencoding=P,!u.transforming){var h=this._readableState;(u.needTransform||h.needReadable||h.length<h.highWaterMark)&&this._read(h.highWaterMark)}},o.prototype._read=function(){var A=this._transformState;A.writechunk===null||A.transforming?A.needTransform=!0:(A.transforming=!0,this._transform(A.writechunk,A.writeencoding,A.afterTransform))},o.prototype._destroy=function(A,P){N.prototype._destroy.call(this,A,function(i){P(i)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(y,k){(function(b,o){(function(){function T(S){var I=this;this.next=null,this.entry=null,this.finish=function(){V(I,S)}}function D(S){return W.from(S)}function r(S){return W.isBuffer(S)||S instanceof Ee}function c(){}function p(S,I,B){$=$||y("./_stream_duplex"),S=S||{},typeof B!="boolean"&&(B=I instanceof $),this.objectMode=!!S.objectMode,B&&(this.objectMode=this.objectMode||!!S.writableObjectMode),this.highWaterMark=X(this,S,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var q=S.decodeStrings===!1;this.decodeStrings=!q,this.defaultEncoding=S.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(s){E(I,s)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=S.emitClose!==!1,this.autoDestroy=!!S.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new T(this)}function a(S){$=$||y("./_stream_duplex");var I=this instanceof $;return I||ce.call(a,this)?(this._writableState=new p(S,this,I),this.writable=!0,S&&(typeof S.write=="function"&&(this._write=S.write),typeof S.writev=="function"&&(this._writev=S.writev),typeof S.destroy=="function"&&(this._destroy=S.destroy),typeof S.final=="function"&&(this._final=S.final)),void te.call(this)):new a(S)}function _(S,I){var B=new Ae;ae(S,B),b.nextTick(I,B)}function N(S,I,B,q){var s;return B===null?s=new me:typeof B!="string"&&!I.objectMode&&(s=new oe("chunk",["string","Buffer"],B)),!s||(ae(S,s),b.nextTick(q,s),!1)}function A(S,I,B){return S.objectMode||S.decodeStrings===!1||typeof I!="string"||(I=W.from(I,B)),I}function P(S,I,B,q,s,e){if(!B){var t=A(I,q,s);q!==t&&(B=!0,s="buffer",q=t)}var n=I.objectMode?1:q.length;I.length+=n;var f=I.length<I.highWaterMark;if(f||(I.needDrain=!0),I.writing||I.corked){var v=I.lastBufferedRequest;I.lastBufferedRequest={chunk:q,encoding:s,isBuf:B,callback:e,next:null},v?v.next=I.lastBufferedRequest:I.bufferedRequest=I.lastBufferedRequest,I.bufferedRequestCount+=1}else i(S,I,!1,n,q,s,e);return f}function i(S,I,B,q,s,e,t){I.writelen=q,I.writecb=t,I.writing=!0,I.sync=!0,I.destroyed?I.onwrite(new be("write")):B?S._writev(s,I.onwrite):S._write(s,e,I.onwrite),I.sync=!1}function u(S,I,B,q,s){--I.pendingcb,B?(b.nextTick(s,q),b.nextTick(F,S,I),S._writableState.errorEmitted=!0,ae(S,q)):(s(q),S._writableState.errorEmitted=!0,ae(S,q),F(S,I))}function h(S){S.writing=!1,S.writecb=null,S.length-=S.writelen,S.writelen=0}function E(S,I){var B=S._writableState,q=B.sync,s=B.writecb;if(typeof s!="function")throw new pe;if(h(B),I)u(S,B,q,I,s);else{var e=m(B)||S.destroyed;e||B.corked||B.bufferProcessing||!B.bufferedRequest||M(S,B),q?b.nextTick(d,S,B,e,s):d(S,B,e,s)}}function d(S,I,B,q){B||R(S,I),I.pendingcb--,q(),F(S,I)}function R(S,I){I.length===0&&I.needDrain&&(I.needDrain=!1,S.emit("drain"))}function M(S,I){I.bufferProcessing=!0;var B=I.bufferedRequest;if(S._writev&&B&&B.next){var q=I.bufferedRequestCount,s=Array(q),e=I.corkedRequestsFree;e.entry=B;for(var t=0,n=!0;B;)s[t]=B,B.isBuf||(n=!1),B=B.next,t+=1;s.allBuffers=n,i(S,I,!0,I.length,s,"",e.finish),I.pendingcb++,I.lastBufferedRequest=null,e.next?(I.corkedRequestsFree=e.next,e.next=null):I.corkedRequestsFree=new T(I),I.bufferedRequestCount=0}else{for(;B;){var f=B.chunk,v=B.encoding,L=B.callback,j=I.objectMode?1:f.length;if(i(S,I,!1,j,f,v,L),B=B.next,I.bufferedRequestCount--,I.writing)break}B===null&&(I.lastBufferedRequest=null)}I.bufferedRequest=B,I.bufferProcessing=!1}function m(S){return S.ending&&S.length===0&&S.bufferedRequest===null&&!S.finished&&!S.writing}function C(S,I){S._final(function(B){I.pendingcb--,B&&ae(S,B),I.prefinished=!0,S.emit("prefinish"),F(S,I)})}function U(S,I){I.prefinished||I.finalCalled||(typeof S._final!="function"||I.destroyed?(I.prefinished=!0,S.emit("prefinish")):(I.pendingcb++,I.finalCalled=!0,b.nextTick(C,S,I)))}function F(S,I){var B=m(I);if(B&&(U(S,I),I.pendingcb===0&&(I.finished=!0,S.emit("finish"),I.autoDestroy))){var q=S._readableState;(!q||q.autoDestroy&&q.endEmitted)&&S.destroy()}return B}function H(S,I,B){I.ending=!0,F(S,I),B&&(I.finished?b.nextTick(B):S.once("finish",B)),I.ended=!0,S.writable=!1}function V(S,I,B){var q=S.entry;for(S.entry=null;q;){var s=q.callback;I.pendingcb--,s(B),q=q.next}I.corkedRequestsFree.next=S}k.exports=a;var $;a.WritableState=p;var Q={deprecate:y("util-deprecate")},te=y("./internal/streams/stream"),W=y("buffer").Buffer,Ee=o.Uint8Array||function(){},se=y("./internal/streams/destroy"),fe=y("./internal/streams/state"),X=fe.getHighWaterMark,K=y("../errors").codes,oe=K.ERR_INVALID_ARG_TYPE,de=K.ERR_METHOD_NOT_IMPLEMENTED,pe=K.ERR_MULTIPLE_CALLBACK,ke=K.ERR_STREAM_CANNOT_PIPE,be=K.ERR_STREAM_DESTROYED,me=K.ERR_STREAM_NULL_VALUES,Ae=K.ERR_STREAM_WRITE_AFTER_END,ge=K.ERR_UNKNOWN_ENCODING,ae=se.errorOrDestroy;y("inherits")(a,te),p.prototype.getBuffer=function(){for(var S=this.bufferedRequest,I=[];S;)I.push(S),S=S.next;return I},(function(){try{Object.defineProperty(p.prototype,"buffer",{get:Q.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var ce;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ce=Function.prototype[Symbol.hasInstance],Object.defineProperty(a,Symbol.hasInstance,{value:function(S){return!!ce.call(this,S)||this===a&&S&&S._writableState instanceof p}})):ce=function(S){return S instanceof this},a.prototype.pipe=function(){ae(this,new ke)},a.prototype.write=function(S,I,B){var q=this._writableState,s=!1,e=!q.objectMode&&r(S);return e&&!W.isBuffer(S)&&(S=D(S)),typeof I=="function"&&(B=I,I=null),e?I="buffer":!I&&(I=q.defaultEncoding),typeof B!="function"&&(B=c),q.ending?_(this,B):(e||N(this,q,S,B))&&(q.pendingcb++,s=P(this,q,e,S,I,B)),s},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var S=this._writableState;S.corked&&(S.corked--,!S.writing&&!S.corked&&!S.bufferProcessing&&S.bufferedRequest&&M(this,S))},a.prototype.setDefaultEncoding=function(S){if(typeof S=="string"&&(S=S.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((S+"").toLowerCase())))throw new ge(S);return this._writableState.defaultEncoding=S,this},Object.defineProperty(a.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(a.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),a.prototype._write=function(S,I,B){B(new de("_write()"))},a.prototype._writev=null,a.prototype.end=function(S,I,B){var q=this._writableState;return typeof S=="function"?(B=S,S=null,I=null):typeof I=="function"&&(B=I,I=null),S!=null&&this.write(S,I),q.corked&&(q.corked=1,this.uncork()),q.ending||H(this,q,B),this},Object.defineProperty(a.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(a.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(S){this._writableState&&(this._writableState.destroyed=S)}}),a.prototype.destroy=se.destroy,a.prototype._undestroy=se.undestroy,a.prototype._destroy=function(S,I){I(S)}}).call(this)}).call(this,y("_process"),typeof le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:le)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(y,k){(function(b){(function(){function o(R,M,m){return M in R?Object.defineProperty(R,M,{value:m,enumerable:!0,configurable:!0,writable:!0}):R[M]=m,R}function T(R,M){return{value:R,done:M}}function D(R){var M=R[_];if(M!==null){var m=R[h].read();m!==null&&(R[i]=null,R[_]=null,R[N]=null,M(T(m,!1)))}}function r(R){b.nextTick(D,R)}function c(R,M){return function(m,C){R.then(function(){return M[P]?void m(T(void 0,!0)):void M[u](m,C)},C)}}var p,a=y("./end-of-stream"),_=Symbol("lastResolve"),N=Symbol("lastReject"),A=Symbol("error"),P=Symbol("ended"),i=Symbol("lastPromise"),u=Symbol("handlePromise"),h=Symbol("stream"),E=Object.getPrototypeOf(function(){}),d=Object.setPrototypeOf((p={get stream(){return this[h]},next:function(){var R=this,M=this[A];if(M!==null)return Promise.reject(M);if(this[P])return Promise.resolve(T(void 0,!0));if(this[h].destroyed)return new Promise(function(F,H){b.nextTick(function(){R[A]?H(R[A]):F(T(void 0,!0))})});var m,C=this[i];if(C)m=new Promise(c(C,this));else{var U=this[h].read();if(U!==null)return Promise.resolve(T(U,!1));m=new Promise(this[u])}return this[i]=m,m}},o(p,Symbol.asyncIterator,function(){return this}),o(p,"return",function(){var R=this;return new Promise(function(M,m){R[h].destroy(null,function(C){return C?void m(C):void M(T(void 0,!0))})})}),p),E);k.exports=function(R){var M,m=Object.create(d,(M={},o(M,h,{value:R,writable:!0}),o(M,_,{value:null,writable:!0}),o(M,N,{value:null,writable:!0}),o(M,A,{value:null,writable:!0}),o(M,P,{value:R._readableState.endEmitted,writable:!0}),o(M,u,{value:function(C,U){var F=m[h].read();F?(m[i]=null,m[_]=null,m[N]=null,C(T(F,!1))):(m[_]=C,m[N]=U)},writable:!0}),M));return m[i]=null,a(R,function(C){if(C&&C.code!=="ERR_STREAM_PREMATURE_CLOSE"){var U=m[N];return U!==null&&(m[i]=null,m[_]=null,m[N]=null,U(C)),void(m[A]=C)}var F=m[_];F!==null&&(m[i]=null,m[_]=null,m[N]=null,F(T(void 0,!0))),m[P]=!0}),R.on("readable",r.bind(null,m)),m}}).call(this)}).call(this,y("_process"))},{"./end-of-stream":24,_process:12}],22:[function(y,k){function b(i,u){var h=Object.keys(i);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(i);u&&(E=E.filter(function(d){return Object.getOwnPropertyDescriptor(i,d).enumerable})),h.push.apply(h,E)}return h}function o(i){for(var u,h=1;h<arguments.length;h++)u=arguments[h]==null?{}:arguments[h],h%2?b(Object(u),!0).forEach(function(E){T(i,E,u[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(u)):b(Object(u)).forEach(function(E){Object.defineProperty(i,E,Object.getOwnPropertyDescriptor(u,E))});return i}function T(i,u,h){return u in i?Object.defineProperty(i,u,{value:h,enumerable:!0,configurable:!0,writable:!0}):i[u]=h,i}function D(i,u){if(!(i instanceof u))throw new TypeError("Cannot call a class as a function")}function r(i,u){for(var h,E=0;E<u.length;E++)h=u[E],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}function c(i,u,h){return u&&r(i.prototype,u),i}function p(i,u,h){_.prototype.copy.call(i,u,h)}var a=y("buffer"),_=a.Buffer,N=y("util"),A=N.inspect,P=A&&A.custom||"inspect";k.exports=(function(){function i(){D(this,i),this.head=null,this.tail=null,this.length=0}return c(i,[{key:"push",value:function(u){var h={data:u,next:null};0<this.length?this.tail.next=h:this.head=h,this.tail=h,++this.length}},{key:"unshift",value:function(u){var h={data:u,next:this.head};this.length===0&&(this.tail=h),this.head=h,++this.length}},{key:"shift",value:function(){if(this.length!==0){var u=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,u}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(u){if(this.length===0)return"";for(var h=this.head,E=""+h.data;h=h.next;)E+=u+h.data;return E}},{key:"concat",value:function(u){if(this.length===0)return _.alloc(0);for(var h=_.allocUnsafe(u>>>0),E=this.head,d=0;E;)p(E.data,h,d),d+=E.data.length,E=E.next;return h}},{key:"consume",value:function(u,h){var E;return u<this.head.data.length?(E=this.head.data.slice(0,u),this.head.data=this.head.data.slice(u)):u===this.head.data.length?E=this.shift():E=h?this._getString(u):this._getBuffer(u),E}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(u){var h=this.head,E=1,d=h.data;for(u-=d.length;h=h.next;){var R=h.data,M=u>R.length?R.length:u;if(d+=M===R.length?R:R.slice(0,u),u-=M,u===0){M===R.length?(++E,this.head=h.next?h.next:this.tail=null):(this.head=h,h.data=R.slice(M));break}++E}return this.length-=E,d}},{key:"_getBuffer",value:function(u){var h=_.allocUnsafe(u),E=this.head,d=1;for(E.data.copy(h),u-=E.data.length;E=E.next;){var R=E.data,M=u>R.length?R.length:u;if(R.copy(h,h.length-u,0,M),u-=M,u===0){M===R.length?(++d,this.head=E.next?E.next:this.tail=null):(this.head=E,E.data=R.slice(M));break}++d}return this.length-=d,h}},{key:P,value:function(u,h){return A(this,o({},h,{depth:0,customInspect:!1}))}}]),i})()},{buffer:3,util:2}],23:[function(y,k){(function(b){(function(){function o(r,c){D(r,c),T(r)}function T(r){r._writableState&&!r._writableState.emitClose||r._readableState&&!r._readableState.emitClose||r.emit("close")}function D(r,c){r.emit("error",c)}k.exports={destroy:function(r,c){var p=this,a=this._readableState&&this._readableState.destroyed,_=this._writableState&&this._writableState.destroyed;return a||_?(c?c(r):r&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,b.nextTick(D,this,r)):b.nextTick(D,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(N){!c&&N?p._writableState?p._writableState.errorEmitted?b.nextTick(T,p):(p._writableState.errorEmitted=!0,b.nextTick(o,p,N)):b.nextTick(o,p,N):c?(b.nextTick(T,p),c(N)):b.nextTick(T,p)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(r,c){var p=r._readableState,a=r._writableState;p&&p.autoDestroy||a&&a.autoDestroy?r.destroy(c):r.emit("error",c)}}}).call(this)}).call(this,y("_process"))},{_process:12}],24:[function(y,k){function b(c){var p=!1;return function(){if(!p){p=!0;for(var a=arguments.length,_=Array(a),N=0;N<a;N++)_[N]=arguments[N];c.apply(this,_)}}}function o(){}function T(c){return c.setHeader&&typeof c.abort=="function"}function D(c,p,a){if(typeof p=="function")return D(c,null,p);p||(p={}),a=b(a||o);var _=p.readable||p.readable!==!1&&c.readable,N=p.writable||p.writable!==!1&&c.writable,A=function(){c.writable||i()},P=c._writableState&&c._writableState.finished,i=function(){N=!1,P=!0,_||a.call(c)},u=c._readableState&&c._readableState.endEmitted,h=function(){_=!1,u=!0,N||a.call(c)},E=function(M){a.call(c,M)},d=function(){var M;return _&&!u?(c._readableState&&c._readableState.ended||(M=new r),a.call(c,M)):N&&!P?(c._writableState&&c._writableState.ended||(M=new r),a.call(c,M)):void 0},R=function(){c.req.on("finish",i)};return T(c)?(c.on("complete",i),c.on("abort",d),c.req?R():c.on("request",R)):N&&!c._writableState&&(c.on("end",A),c.on("close",A)),c.on("end",h),c.on("finish",i),p.error!==!1&&c.on("error",E),c.on("close",d),function(){c.removeListener("complete",i),c.removeListener("abort",d),c.removeListener("request",R),c.req&&c.req.removeListener("finish",i),c.removeListener("end",A),c.removeListener("close",A),c.removeListener("finish",i),c.removeListener("end",h),c.removeListener("error",E),c.removeListener("close",d)}}var r=y("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;k.exports=D},{"../../../errors":15}],25:[function(y,k){k.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(y,k){function b(P){var i=!1;return function(){i||(i=!0,P.apply(void 0,arguments))}}function o(P){if(P)throw P}function T(P){return P.setHeader&&typeof P.abort=="function"}function D(P,i,u,h){h=b(h);var E=!1;P.on("close",function(){E=!0}),a===void 0&&(a=y("./end-of-stream")),a(P,{readable:i,writable:u},function(R){return R?h(R):(E=!0,void h())});var d=!1;return function(R){if(!E)return d?void 0:(d=!0,T(P)?P.abort():typeof P.destroy=="function"?P.destroy():void h(R||new A("pipe")))}}function r(P){P()}function c(P,i){return P.pipe(i)}function p(P){return P.length&&typeof P[P.length-1]=="function"?P.pop():o}var a,_=y("../../../errors").codes,N=_.ERR_MISSING_ARGS,A=_.ERR_STREAM_DESTROYED;k.exports=function(){for(var P=arguments.length,i=Array(P),u=0;u<P;u++)i[u]=arguments[u];var h=p(i);if(Array.isArray(i[0])&&(i=i[0]),2>i.length)throw new N("streams");var E,d=i.map(function(R,M){var m=M<i.length-1;return D(R,m,0<M,function(C){E||(E=C),C&&d.forEach(r),m||(d.forEach(r),h(E))})});return i.reduce(c)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(y,k){function b(T,D,r){return T.highWaterMark==null?D?T[r]:null:T.highWaterMark}var o=y("../../../errors").codes.ERR_INVALID_OPT_VALUE;k.exports={getHighWaterMark:function(T,D,r,c){var p=b(D,c,r);if(p!=null){if(!(isFinite(p)&&g(p)===p)||0>p){var a=c?r:"highWaterMark";throw new o(a,p)}return g(p)}return T.objectMode?16:16384}}},{"../../../errors":15}],28:[function(y,k){k.exports=y("events").EventEmitter},{events:7}],29:[function(y,k,b){b=k.exports=y("./lib/_stream_readable.js"),b.Stream=b,b.Readable=b,b.Writable=y("./lib/_stream_writable.js"),b.Duplex=y("./lib/_stream_duplex.js"),b.Transform=y("./lib/_stream_transform.js"),b.PassThrough=y("./lib/_stream_passthrough.js"),b.finished=y("./lib/internal/streams/end-of-stream.js"),b.pipeline=y("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(y,k,b){function o(c,p){for(var a in c)p[a]=c[a]}function T(c,p,a){return r(c,p,a)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var D=y("buffer"),r=D.Buffer;r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?k.exports=D:(o(D,b),b.Buffer=T),T.prototype=Object.create(r.prototype),o(r,T),T.from=function(c,p,a){if(typeof c=="number")throw new TypeError("Argument must not be a number");return r(c,p,a)},T.alloc=function(c,p,a){if(typeof c!="number")throw new TypeError("Argument must be a number");var _=r(c);return p===void 0?_.fill(0):typeof a=="string"?_.fill(p,a):_.fill(p),_},T.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return r(c)},T.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return D.SlowBuffer(c)}},{buffer:3}],31:[function(y,k,b){function o(d){if(!d)return"utf8";for(var R;;)switch(d){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return d;default:if(R)return;d=(""+d).toLowerCase(),R=!0}}function T(d){var R=o(d);if(typeof R!="string"&&(h.isEncoding===E||!E(d)))throw new Error("Unknown encoding: "+d);return R||d}function D(d){this.encoding=T(d);var R;switch(this.encoding){case"utf16le":this.text=_,this.end=N,R=4;break;case"utf8":this.fillLast=a,R=4;break;case"base64":this.text=A,this.end=P,R=3;break;default:return this.write=i,void(this.end=u)}this.lastNeed=0,this.lastTotal=0,this.lastChar=h.allocUnsafe(R)}function r(d){return 127>=d?0:d>>5==6?2:d>>4==14?3:d>>3==30?4:d>>6==2?-1:-2}function c(d,R,M){var m=R.length-1;if(m<M)return 0;var C=r(R[m]);return 0<=C?(0<C&&(d.lastNeed=C-1),C):--m<M||C===-2?0:(C=r(R[m]),0<=C?(0<C&&(d.lastNeed=C-2),C):--m<M||C===-2?0:(C=r(R[m]),0<=C?(0<C&&(C===2?C=0:d.lastNeed=C-3),C):0))}function p(d,R){if((192&R[0])!=128)return d.lastNeed=0,"";if(1<d.lastNeed&&1<R.length){if((192&R[1])!=128)return d.lastNeed=1,"";if(2<d.lastNeed&&2<R.length&&(192&R[2])!=128)return d.lastNeed=2,""}}function a(d){var R=this.lastTotal-this.lastNeed,M=p(this,d);return M===void 0?this.lastNeed<=d.length?(d.copy(this.lastChar,R,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(d.copy(this.lastChar,R,0,d.length),void(this.lastNeed-=d.length)):M}function _(d,R){if((d.length-R)%2==0){var M=d.toString("utf16le",R);if(M){var m=M.charCodeAt(M.length-1);if(55296<=m&&56319>=m)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=d[d.length-2],this.lastChar[1]=d[d.length-1],M.slice(0,-1)}return M}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=d[d.length-1],d.toString("utf16le",R,d.length-1)}function N(d){var R=d&&d.length?this.write(d):"";if(this.lastNeed){var M=this.lastTotal-this.lastNeed;return R+this.lastChar.toString("utf16le",0,M)}return R}function A(d,R){var M=(d.length-R)%3;return M==0?d.toString("base64",R):(this.lastNeed=3-M,this.lastTotal=3,M==1?this.lastChar[0]=d[d.length-1]:(this.lastChar[0]=d[d.length-2],this.lastChar[1]=d[d.length-1]),d.toString("base64",R,d.length-M))}function P(d){var R=d&&d.length?this.write(d):"";return this.lastNeed?R+this.lastChar.toString("base64",0,3-this.lastNeed):R}function i(d){return d.toString(this.encoding)}function u(d){return d&&d.length?this.write(d):""}var h=y("safe-buffer").Buffer,E=h.isEncoding||function(d){switch(d=""+d,d&&d.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};b.StringDecoder=D,D.prototype.write=function(d){if(d.length===0)return"";var R,M;if(this.lastNeed){if(R=this.fillLast(d),R===void 0)return"";M=this.lastNeed,this.lastNeed=0}else M=0;return M<d.length?R?R+this.text(d,M):this.text(d,M):R||""},D.prototype.end=function(d){var R=d&&d.length?this.write(d):"";return this.lastNeed?R+"":R},D.prototype.text=function(d,R){var M=c(this,d,R);if(!this.lastNeed)return d.toString("utf8",R);this.lastTotal=M;var m=d.length-(M-this.lastNeed);return d.copy(this.lastChar,0,m),d.toString("utf8",R,m)},D.prototype.fillLast=function(d){return this.lastNeed<=d.length?(d.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(d.copy(this.lastChar,this.lastTotal-this.lastNeed,0,d.length),void(this.lastNeed-=d.length))}},{"safe-buffer":30}],32:[function(y,k){(function(b){(function(){function o(T){try{if(!b.localStorage)return!1}catch{return!1}var D=b.localStorage[T];return D!=null&&(D+"").toLowerCase()==="true"}k.exports=function(T,D){function r(){if(!c){if(o("throwDeprecation"))throw new Error(D);o("traceDeprecation")?console.trace(D):console.warn(D),c=!0}return T.apply(this,arguments)}if(o("noDeprecation"))return T;var c=!1;return r}}).call(this)}).call(this,typeof le>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:le)},{}],"/":[function(y,k){function b(P){return P.replace(/a=ice-options:trickle\s\n/g,"")}function o(P){console.warn(P)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const T=y("debug")("simple-peer"),D=y("get-browser-rtc"),r=y("randombytes"),c=y("readable-stream"),p=y("queue-microtask"),a=y("err-code"),{Buffer:_}=y("buffer"),N=65536;class A extends c.Duplex{constructor(i){if(i=Object.assign({allowHalfOpen:!1},i),super(i),this._id=r(4).toString("hex").slice(0,7),this._debug("new peer %o",i),this.channelName=i.initiator?i.channelName||r(20).toString("hex"):null,this.initiator=i.initiator||!1,this.channelConfig=i.channelConfig||A.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},A.config,i.config),this.offerOptions=i.offerOptions||{},this.answerOptions=i.answerOptions||{},this.sdpTransform=i.sdpTransform||(u=>u),this.streams=i.streams||(i.stream?[i.stream]:[]),this.trickle=i.trickle===void 0||i.trickle,this.allowHalfTrickle=i.allowHalfTrickle!==void 0&&i.allowHalfTrickle,this.iceCompleteTimeout=i.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=i.wrtc&&typeof i.wrtc=="object"?i.wrtc:D(),!this._wrtc)throw a(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(u){return void this.destroy(a(u,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=u=>{this._onIceCandidate(u)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(u=>{this.destroy(a(u,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=u=>{this._setupData(u)},this.streams&&this.streams.forEach(u=>{this.addStream(u)}),this._pc.ontrack=u=>{this._onTrack(u)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(i){if(!this.destroying){if(this.destroyed)throw a(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof i=="string")try{i=JSON.parse(i)}catch{i={}}this._debug("signal()"),i.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),i.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(i.transceiverRequest.kind,i.transceiverRequest.init)),i.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(i.candidate):this._pendingCandidates.push(i.candidate)),i.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(i)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(u=>{this._addIceCandidate(u)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(u=>{this.destroy(a(u,"ERR_SET_REMOTE_DESCRIPTION"))}),i.sdp||i.candidate||i.renegotiate||i.transceiverRequest||this.destroy(a(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(i){const u=new this._wrtc.RTCIceCandidate(i);this._pc.addIceCandidate(u).catch(h=>{!u.address||u.address.endsWith(".local")?o("Ignoring unsupported ICE candidate."):this.destroy(a(h,"ERR_ADD_ICE_CANDIDATE"))})}send(i){if(!this.destroying){if(this.destroyed)throw a(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(i)}}addTransceiver(i,u){if(!this.destroying){if(this.destroyed)throw a(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(i,u),this._needsNegotiation()}catch(h){this.destroy(a(h,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:i,init:u}})}}addStream(i){if(!this.destroying){if(this.destroyed)throw a(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),i.getTracks().forEach(u=>{this.addTrack(u,i)})}}addTrack(i,u){if(this.destroying)return;if(this.destroyed)throw a(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const h=this._senderMap.get(i)||new Map;let E=h.get(u);if(!E)E=this._pc.addTrack(i,u),h.set(u,E),this._senderMap.set(i,h),this._needsNegotiation();else throw E.removed?a(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):a(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(i,u,h){if(this.destroying)return;if(this.destroyed)throw a(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const E=this._senderMap.get(i),d=E?E.get(h):null;if(!d)throw a(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");u&&this._senderMap.set(u,E),d.replaceTrack==null?this.destroy(a(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):d.replaceTrack(u)}removeTrack(i,u){if(this.destroying)return;if(this.destroyed)throw a(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const h=this._senderMap.get(i),E=h?h.get(u):null;if(!E)throw a(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{E.removed=!0,this._pc.removeTrack(E)}catch(d){d.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(E):this.destroy(a(d,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(i){if(!this.destroying){if(this.destroyed)throw a(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),i.getTracks().forEach(u=>{this.removeTrack(u,i)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,p(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw a(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(i){this._destroy(i,()=>{})}_destroy(i,u){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),p(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",i&&(i.message||i)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),this.emit("close"),u()}))}_setupData(i){if(!i.channel)return this.destroy(a(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=i.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=N),this.channelName=this._channel.label,this._channel.onmessage=h=>{this._onChannelMessage(h)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=h=>{const E=h.error instanceof Error?h.error:new Error(`Datachannel error: ${h.message} ${h.filename}:${h.lineno}:${h.colno}`);this.destroy(a(E,"ERR_DATA_CHANNEL"))};let u=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(u&&this._onChannelClose(),u=!0):u=!1},5e3)}_read(){}_write(i,u,h){if(this.destroyed)return h(a(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(i)}catch(E){return this.destroy(a(E,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>N?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=h):h(null)}else this._debug("write before connect"),this._chunk=i,this._cb=h}_onFinish(){if(!this.destroyed){const i=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?i():this.once("connect",i)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(i=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(i.sdp=b(i.sdp)),i.sdp=this.sdpTransform(i.sdp);const u=()=>{if(!this.destroyed){const h=this._pc.localDescription||i;this._debug("signal"),this.emit("signal",{type:h.type,sdp:h.sdp})}};this._pc.setLocalDescription(i).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?u():this.once("_iceComplete",u))}).catch(h=>{this.destroy(a(h,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(i=>{this.destroy(a(i,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(i=>{i.mid||!i.sender.track||i.requested||(i.requested=!0,this.addTransceiver(i.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(i=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(i.sdp=b(i.sdp)),i.sdp=this.sdpTransform(i.sdp);const u=()=>{if(!this.destroyed){const h=this._pc.localDescription||i;this._debug("signal"),this.emit("signal",{type:h.type,sdp:h.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(i).then(()=>{this.destroyed||(this.trickle||this._iceComplete?u():this.once("_iceComplete",u))}).catch(h=>{this.destroy(a(h,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(i=>{this.destroy(a(i,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(a(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const i=this._pc.iceConnectionState,u=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",i,u),this.emit("iceStateChange",i,u),(i==="connected"||i==="completed")&&(this._pcReady=!0,this._maybeReady()),i==="failed"&&this.destroy(a(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),i==="closed"&&this.destroy(a(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(i){const u=h=>(Object.prototype.toString.call(h.values)==="[object Array]"&&h.values.forEach(E=>{Object.assign(h,E)}),h);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(h=>{const E=[];h.forEach(d=>{E.push(u(d))}),i(null,E)},h=>i(h)):0<this._pc.getStats.length?this._pc.getStats(h=>{if(this.destroyed)return;const E=[];h.result().forEach(d=>{const R={};d.names().forEach(M=>{R[M]=d.stat(M)}),R.id=d.id,R.type=d.type,R.timestamp=d.timestamp,E.push(u(R))}),i(null,E)},h=>i(h)):i(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const i=()=>{this.destroyed||this.getStats((u,h)=>{if(this.destroyed)return;u&&(h=[]);const E={},d={},R={};let M=!1;h.forEach(C=>{(C.type==="remotecandidate"||C.type==="remote-candidate")&&(E[C.id]=C),(C.type==="localcandidate"||C.type==="local-candidate")&&(d[C.id]=C),(C.type==="candidatepair"||C.type==="candidate-pair")&&(R[C.id]=C)});const m=C=>{M=!0;let U=d[C.localCandidateId];U&&(U.ip||U.address)?(this.localAddress=U.ip||U.address,this.localPort=+U.port):U&&U.ipAddress?(this.localAddress=U.ipAddress,this.localPort=+U.portNumber):typeof C.googLocalAddress=="string"&&(U=C.googLocalAddress.split(":"),this.localAddress=U[0],this.localPort=+U[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let F=E[C.remoteCandidateId];F&&(F.ip||F.address)?(this.remoteAddress=F.ip||F.address,this.remotePort=+F.port):F&&F.ipAddress?(this.remoteAddress=F.ipAddress,this.remotePort=+F.portNumber):typeof C.googRemoteAddress=="string"&&(F=C.googRemoteAddress.split(":"),this.remoteAddress=F[0],this.remotePort=+F[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(h.forEach(C=>{C.type==="transport"&&C.selectedCandidatePairId&&m(R[C.selectedCandidatePairId]),(C.type==="googCandidatePair"&&C.googActiveConnection==="true"||(C.type==="candidatepair"||C.type==="candidate-pair")&&C.selected)&&m(C)}),!M&&(!Object.keys(R).length||Object.keys(d).length))return void setTimeout(i,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(U){return this.destroy(a(U,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const C=this._cb;this._cb=null,C(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};i()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>N)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(i=>{this._pc.removeTrack(i),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(i){this.destroyed||(i.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:i.candidate.candidate,sdpMLineIndex:i.candidate.sdpMLineIndex,sdpMid:i.candidate.sdpMid}}):!i.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),i.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(i){if(this.destroyed)return;let u=i.data;u instanceof ArrayBuffer&&(u=_.from(u)),this.push(u)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const i=this._cb;this._cb=null,i(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(i){this.destroyed||i.streams.forEach(u=>{this._debug("on track"),this.emit("track",i.track,u),this._remoteTracks.push({track:i.track,stream:u}),this._remoteStreams.some(h=>h.id===u.id)||(this._remoteStreams.push(u),p(()=>{this._debug("on stream"),this.emit("stream",u)}))})}_debug(){const i=[].slice.call(arguments);i[0]="["+this._id+"] "+i[0],T.apply(null,i)}}A.WEBRTC_SUPPORT=!!D(),A.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},A.channelConfig={},k.exports=A},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(We)),We.exports}var hn=un();const fn=Kt(hn),Qe=0,Ze=1,Ct=2,St=(w,l)=>{Z(w,Qe);const g=ut(l);he(w,g)},Rt=(w,l,g)=>{Z(w,Ze),he(w,jt(l,g))},dn=(w,l,g)=>Rt(l,g,xe(w)),Tt=(w,l,g,O)=>{try{lt(l,xe(w),g)}catch(x){O?.(x),console.error("Caught error while handling a Yjs update",x)}},pn=(w,l)=>{Z(w,Ct),he(w,l)},gn=Tt,yn=(w,l,g,O,x)=>{const y=Le(w);switch(y){case Qe:dn(w,l,g);break;case Ze:Tt(w,g,O,x);break;case Ct:gn(w,g,O,x);break;default:throw new Error("Unknown message type")}return y},He=3e4;class bn extends ht{constructor(l){super(),this.doc=l,this.clientID=l.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const g=ve();this.getLocalState()!==null&&He/2<=g-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const O=[];this.meta.forEach((x,y)=>{y!==this.clientID&&He<=g-x.lastUpdated&&this.states.has(y)&&O.push(y)}),O.length>0&&Ge(this,O,"timeout")},pt(He/10)),l.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(l){const g=this.clientID,O=this.meta.get(g),x=O===void 0?0:O.clock+1,y=this.states.get(g);l===null?this.states.delete(g):this.states.set(g,l),this.meta.set(g,{clock:x,lastUpdated:ve()});const k=[],b=[],o=[],T=[];l===null?T.push(g):y==null?l!=null&&k.push(g):(b.push(g),gt(y,l)||o.push(g)),(k.length>0||o.length>0||T.length>0)&&this.emit("change",[{added:k,updated:o,removed:T},"local"]),this.emit("update",[{added:k,updated:b,removed:T},"local"])}setLocalStateField(l,g){const O=this.getLocalState();O!==null&&this.setLocalState({...O,[l]:g})}getStates(){return this.states}}const Ge=(w,l,g)=>{const O=[];for(let x=0;x<l.length;x++){const y=l[x];if(w.states.has(y)){if(w.states.delete(y),y===w.clientID){const k=w.meta.get(y);w.meta.set(y,{clock:k.clock+1,lastUpdated:ve()})}O.push(y)}}O.length>0&&(w.emit("change",[{added:[],updated:[],removed:O},g]),w.emit("update",[{added:[],updated:[],removed:O},g]))},Ue=(w,l,g=w.states)=>{const O=l.length,x=ne();Z(x,O);for(let y=0;y<O;y++){const k=l[y],b=g.get(k)||null,o=w.meta.get(k).clock;Z(x,k),Z(x,o),Fe(x,JSON.stringify(b))}return re(x)},mn=(w,l,g)=>{const O=je(l),x=ve(),y=[],k=[],b=[],o=[],T=Le(O);for(let D=0;D<T;D++){const r=Le(O);let c=Le(O);const p=JSON.parse(Ke(O)),a=w.meta.get(r),_=w.states.get(r),N=a===void 0?0:a.clock;(N<c||N===c&&p===null&&w.states.has(r))&&(p===null?r===w.clientID&&w.getLocalState()!=null?c++:w.states.delete(r):w.states.set(r,p),w.meta.set(r,{clock:c,lastUpdated:x}),a===void 0&&p!==null?y.push(r):a!==void 0&&p===null?o.push(r):p!==null&&(gt(p,_)||b.push(r),k.push(r)))}(y.length>0||b.length>0||o.length>0)&&w.emit("change",[{added:y,updated:b,removed:o},g]),(y.length>0||k.length>0||o.length>0)&&w.emit("update",[{added:y,updated:k,removed:o},g])},_n=(w,l)=>{const g=nt(w).buffer,O=nt(l).buffer;return crypto.subtle.importKey("raw",g,"PBKDF2",!1,["deriveKey"]).then(x=>crypto.subtle.deriveKey({name:"PBKDF2",salt:O,iterations:1e5,hash:"SHA-256"},x,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},kt=(w,l)=>{if(!l)return Je(w);const g=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:g},l,w).then(O=>{const x=ne();return Fe(x,"AES-GCM"),he(x,g),he(x,new Uint8Array(O)),re(x)})},wn=(w,l)=>{const g=ne();return Ht(g,w),kt(re(g),l)},At=(w,l)=>{if(!l)return Je(w);const g=je(w);Ke(g)!=="AES-GCM"&&Wt(yt("Unknown encryption algorithm"));const x=xe(g),y=xe(g);return crypto.subtle.decrypt({name:"AES-GCM",iv:x},l,y).then(k=>new Uint8Array(k))},vn=(w,l)=>At(w,l).then(g=>qt(je(new Uint8Array(g)))),ie=zt("y-webrtc"),Te=0,It=3,Oe=1,et=4,Be=new Map,we=new Map,Lt=w=>{let l=!0;w.webrtcConns.forEach(g=>{g.synced||(l=!1)}),(!l&&w.synced||l&&!w.synced)&&(w.synced=l,w.provider.emit("synced",[{synced:l}]),ie("synced ",ue,w.name,De," with all peers"))},xt=(w,l,g)=>{const O=je(l),x=ne(),y=Le(O);if(w===void 0)return null;const k=w.awareness,b=w.doc;let o=!1;switch(y){case Te:{Z(x,Te);const T=yn(O,x,b,w);T===Ze&&!w.synced&&g(),T===Qe&&(o=!0);break}case It:Z(x,Oe),he(x,Ue(k,Array.from(k.getStates().keys()))),o=!0;break;case Oe:mn(k,xe(O),w);break;case et:{const T=$t(O)===1,D=Ke(O);if(D!==w.peerId&&(w.bcConns.has(D)&&!T||!w.bcConns.has(D)&&T)){const r=[],c=[];T?(w.bcConns.add(D),c.push(D)):(w.bcConns.delete(D),r.push(D)),w.provider.emit("peers",[{added:c,removed:r,webrtcPeers:Array.from(w.webrtcConns.keys()),bcPeers:Array.from(w.bcConns)}]),Dt(w)}break}default:return console.error("Unable to compute message"),x}return o?x:null},En=(w,l)=>{const g=w.room;return ie("received message from ",ue,w.remotePeerId,mt," (",g.name,")",De,_t),xt(g,l,()=>{w.synced=!0,ie("synced ",ue,g.name,De," with ",ue,w.remotePeerId),Lt(g)})},Ve=(w,l)=>{ie("send message to ",ue,w.remotePeerId,De,mt," (",w.room.name,")",_t);try{w.peer.send(re(l))}catch{}},Cn=(w,l)=>{ie("broadcast message in ",ue,w.name,De),w.webrtcConns.forEach(g=>{try{g.peer.send(l)}catch{}})};class ot{constructor(l,g,O,x){ie("establishing connection to ",ue,O),this.room=x,this.remotePeerId=O,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new fn({initiator:g,...x.provider.peerOpts}),this.peer.on("signal",y=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),tt(l,x,{to:O,from:x.peerId,type:"signal",token:this.glareToken,signal:y})}),this.peer.on("connect",()=>{ie("connected to ",ue,O),this.connected=!0;const k=x.provider.doc,b=x.awareness,o=ne();Z(o,Te),St(o,k),Ve(this,o);const T=b.getStates();if(T.size>0){const D=ne();Z(D,Oe),he(D,Ue(b,Array.from(T.keys()))),Ve(this,D)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,x.webrtcConns.has(this.remotePeerId)&&(x.webrtcConns.delete(this.remotePeerId),x.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(x.webrtcConns.keys()),bcPeers:Array.from(x.bcConns)}])),Lt(x),this.peer.destroy(),ie("closed connection to ",ue,O),$e(x)}),this.peer.on("error",y=>{ie("Error in connection to ",ue,O,": ",y),$e(x)}),this.peer.on("data",y=>{const k=En(this,y);k!==null&&Ve(this,k)})}destroy(){this.peer.destroy()}}const ye=(w,l)=>kt(l,w.key).then(g=>w.mux(()=>cn(w.name,g))),at=(w,l)=>{w.bcconnected&&ye(w,l),Cn(w,l)},$e=w=>{Be.forEach(l=>{l.connected&&(l.send({type:"subscribe",topics:[w.name]}),w.webrtcConns.size<w.provider.maxConns&&tt(l,w,{type:"announce",from:w.peerId}))})},Dt=w=>{if(w.provider.filterBcConns){const l=ne();Z(l,et),bt(l,1),Fe(l,w.peerId),ye(w,re(l))}};class Sn{constructor(l,g,O,x){this.peerId=Gt(),this.doc=l,this.awareness=g.awareness,this.provider=g,this.synced=!1,this.name=O,this.key=x,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=ln(),this.bcconnected=!1,this._bcSubscriber=y=>At(new Uint8Array(y),x).then(k=>this.mux(()=>{const b=xt(this,k,()=>{});b&&ye(this,re(b))})),this._docUpdateHandler=(y,k)=>{const b=ne();Z(b,Te),pn(b,y),at(this,re(b))},this._awarenessUpdateHandler=({added:y,updated:k,removed:b},o)=>{const T=y.concat(k).concat(b),D=ne();Z(D,Oe),he(D,Ue(this.awareness,T)),at(this,re(D))},this._beforeUnloadHandler=()=>{Ge(this.awareness,[l.clientID],"window unload"),we.forEach(y=>{y.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),$e(this);const l=this.name;on(l,this._bcSubscriber),this.bcconnected=!0,Dt(this);const g=ne();Z(g,Te),St(g,this.doc),ye(this,re(g));const O=ne();Z(O,Te),Rt(O,this.doc),ye(this,re(O));const x=ne();Z(x,It),ye(this,re(x));const y=ne();Z(y,Oe),he(y,Ue(this.awareness,[this.doc.clientID])),ye(this,re(y))}disconnect(){Be.forEach(g=>{g.connected&&g.send({type:"unsubscribe",topics:[this.name]})}),Ge(this.awareness,[this.doc.clientID],"disconnect");const l=ne();Z(l,et),bt(l,0),Fe(l,this.peerId),ye(this,re(l)),an(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(g=>g.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const Rn=(w,l,g,O)=>{if(we.has(g))throw yt(`A Yjs Doc connected to room "${g}" already exists!`);const x=new Sn(w,l,g,O);return we.set(g,x),x},tt=(w,l,g)=>{l.key?wn(g,l.key).then(O=>{w.send({type:"publish",topic:l.name,data:dt(O)})}):w.send({type:"publish",topic:l.name,data:g})};class Tn extends nn{constructor(l){super(l),this.providers=new Set,this.on("connect",()=>{ie(`connected (${l})`);const g=Array.from(we.keys());this.send({type:"subscribe",topics:g}),we.forEach(O=>tt(this,O,{type:"announce",from:O.peerId}))}),this.on("message",g=>{switch(g.type){case"publish":{const O=g.topic,x=we.get(O);if(x==null||typeof O!="string")return;const y=k=>{const b=x.webrtcConns,o=x.peerId;if(k==null||k.from===o||k.to!==void 0&&k.to!==o||x.bcConns.has(k.from))return;const T=b.has(k.from)?()=>{}:()=>x.provider.emit("peers",[{removed:[],added:[k.from],webrtcPeers:Array.from(x.webrtcConns.keys()),bcPeers:Array.from(x.bcConns)}]);switch(k.type){case"announce":b.size<x.provider.maxConns&&(Pe(b,k.from,()=>new ot(this,!0,k.from,x)),T());break;case"signal":if(k.signal.type==="offer"){const D=b.get(k.from);if(D){const r=k.token,c=D.glareToken;if(c&&c>r){ie("offer rejected: ",k.from);return}D.glareToken=void 0}}if(k.signal.type==="answer"){ie("offer answered by: ",k.from);const D=b.get(k.from);D.glareToken=void 0}k.to===o&&(Pe(b,k.from,()=>new ot(this,!1,k.from,x)).peer.signal(k.signal),T());break}};x.key?typeof g.data=="string"&&vn(ft(g.data),x.key).then(y):y(g.data)}}}),this.on("disconnect",()=>ie(`disconnect (${l})`))}}const Ye=w=>{w.emit("status",[{connected:w.connected}])};class ct extends Vt{constructor(l,g,{signaling:O=["wss://y-webrtc-eu.fly.dev"],password:x=null,awareness:y=new bn(g),maxConns:k=20+pt(Yt()*15),filterBcConns:b=!0,peerOpts:o={}}={}){super(),this.roomName=l,this.doc=g,this.filterBcConns=b,this.awareness=y,this.shouldConnect=!1,this.signalingUrls=O,this.signalingConns=[],this.maxConns=k,this.peerOpts=o,this.key=x?_n(x,l):Je(null),this.room=null,this.key.then(T=>{this.room=Rn(g,this,l,T),this.shouldConnect?this.room.connect():this.room.disconnect(),Ye(this)}),this.connect(),this.destroy=this.destroy.bind(this),g.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(l=>{const g=Pe(Be,l,()=>new Tn(l));this.signalingConns.push(g),g.providers.add(this)}),this.room&&(this.room.connect(),Ye(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(l=>{l.providers.delete(this),l.providers.size===0&&(l.destroy(),Be.delete(l.url))}),this.room&&(this.room.disconnect(),Ye(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),we.delete(this.roomName)}),super.destroy()}}const kn=["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"];class xn extends wt{activeSession=null;sessionDoc=null;webrtcProvider=null;bluetoothProvider=null;user;signalingServers;defaultExpiryMs;constructor(l){super(),this.user=l.user,this.signalingServers=l.signalingServers??kn,this.defaultExpiryMs=l.defaultExpiryMs??14400*1e3}get isHosting(){return this.activeSession?.hostId===this.user.id}get currentSession(){return this.activeSession}detectBestTransport(){return typeof navigator<"u"&&navigator.onLine?"webrtc":vt()?"bluetooth":"local-network"}async createSession(l,g={}){await this.leaveSession();const O=g.type??this.detectBestTransport(),x=g.expiresInMs??this.defaultExpiryMs,y=Jt(this.user.id,O,{libraryScope:g.libraryScope??"full",selectedSongIds:g.selectedSongIds,expiresInMs:x});switch(this.sessionDoc=new rt({guid:`session-${y.id}`}),O){case"webrtc":await this.initWebRTCHost(y,g.password);break;case"bluetooth":await this.initBluetoothHost(y);break;case"local-network":await this.initLocalNetworkHost(y);break}this.activeSession=y;const k={sessionId:y.id,type:y.type,hostId:this.user.id,hostName:this.user.displayName,connectionInfo:y.connectionInfo,libraryManifest:l,createdAt:y.createdAt.getTime(),expiresAt:y.expiresAt?.getTime()};return this.emit("session-created",[{session:y,qrPayload:k}]),k}async joinSession(l){const{payload:g}=l;if(g.expiresAt&&Date.now()>g.expiresAt)throw new Error("Session has expired");await this.leaveSession();const O={id:g.sessionId,hostId:g.hostId,type:g.type,connectionInfo:g.connectionInfo,libraryScope:"full",createdAt:new Date(g.createdAt),expiresAt:g.expiresAt?new Date(g.expiresAt):void 0};switch(this.sessionDoc=new rt({guid:`session-${O.id}`}),g.type){case"webrtc":await this.connectWebRTC(O);break;case"bluetooth":await this.connectBluetooth(O);break;case"local-network":await this.connectLocalNetwork(O);break}this.activeSession=O,this.emit("session-joined",[{session:O,manifest:g.libraryManifest}])}async leaveSession(){this.webrtcProvider&&(this.webrtcProvider.destroy(),this.webrtcProvider=null),this.bluetoothProvider&&(this.bluetoothProvider.destroy(),this.bluetoothProvider=null),this.sessionDoc&&(this.sessionDoc.destroy(),this.sessionDoc=null);const l=this.activeSession!==null;this.activeSession=null,l&&this.emit("session-left",[{}])}getSessionDoc(){return this.sessionDoc}async initWebRTCHost(l,g){if(!this.sessionDoc)throw new Error("Session doc not initialized");l.connectionInfo.type==="webrtc"&&(l.connectionInfo.signalingServer=this.signalingServers[0],l.connectionInfo.password=g),this.webrtcProvider=new ct(l.id,this.sessionDoc,{signaling:this.signalingServers,password:g}),this.setupWebRTCListeners()}async connectWebRTC(l){if(!this.sessionDoc)throw new Error("Session doc not initialized");const g=l.connectionInfo;if(g.type!=="webrtc")throw new Error("Invalid connection info");this.webrtcProvider=new ct(l.id,this.sessionDoc,{signaling:[g.signalingServer],password:g.password}),this.setupWebRTCListeners()}setupWebRTCListeners(){this.webrtcProvider&&(this.webrtcProvider.on("synced",l=>{this.emit("sync-status",[{synced:l.synced,transport:"webrtc"}])}),this.webrtcProvider.on("peers",l=>{this.emit("peers-changed",[{count:l.webrtcPeers.length,transport:"webrtc"}])}))}async initBluetoothHost(l){if(!this.sessionDoc)throw new Error("Session doc not initialized");this.bluetoothProvider=new it(this.sessionDoc,{sessionId:l.id,deviceName:`Gigwidget-${this.user.displayName}`}),l.connectionInfo.type==="bluetooth"&&(l.connectionInfo.deviceName=`Gigwidget-${this.user.displayName}`),this.setupBluetoothListeners()}async connectBluetooth(l){if(!this.sessionDoc)throw new Error("Session doc not initialized");this.bluetoothProvider=new it(this.sessionDoc,{sessionId:l.id});const g=await this.bluetoothProvider.scan();g&&await this.bluetoothProvider.connectToDevice(g),this.setupBluetoothListeners()}setupBluetoothListeners(){this.bluetoothProvider&&(this.bluetoothProvider.on("peer-connected",()=>{this.emit("peers-changed",[{count:this.bluetoothProvider?.peerCount??0,transport:"bluetooth"}])}),this.bluetoothProvider.on("peer-disconnected",()=>{this.emit("peers-changed",[{count:this.bluetoothProvider?.peerCount??0,transport:"bluetooth"}])}),this.bluetoothProvider.on("error",l=>{this.emit("error",[l])}))}async initLocalNetworkHost(l){console.warn("Local network transport not yet implemented"),l.connectionInfo.type==="local-network"&&(l.connectionInfo.addresses=["192.168.1.1"],l.connectionInfo.port=8080,l.connectionInfo.token=Xt())}async connectLocalNetwork(l){console.warn("Local network transport not yet implemented")}destroy(){this.leaveSession().catch(console.error),super.destroy()}}export{it as BluetoothProvider,Nn as IndexeddbPersistence,wt as Observable,xn as SessionManager,ct as WebrtcProvider,vt as isBluetoothAvailable};
//# sourceMappingURL=BfUQ7lDy.js.map
