{"version":3,"file":"Dyjw1x4N.js","sources":["../../../../../../../../packages/core/dist/services/permissions.js"],"sourcesContent":["/**\n * Permissions service for subscription tier enforcement\n *\n * Tier capabilities:\n * - free: View songs only (read-only mode)\n * - basic: Edit songs and chords, save to cloud\n * - pro: All basic + create/host shared sessions\n * - mod: All pro + create system-default chords and instruments\n */\n// ============================================================================\n// Tier Permission Mapping\n// ============================================================================\nconst TIER_PERMISSIONS = {\n    free: [\n        'view_songs',\n        'join_sessions',\n    ],\n    basic: [\n        'view_songs',\n        'edit_songs',\n        'create_songs',\n        'delete_songs',\n        'edit_chords',\n        'save_remotely',\n        'join_sessions',\n    ],\n    pro: [\n        'view_songs',\n        'edit_songs',\n        'create_songs',\n        'delete_songs',\n        'edit_chords',\n        'save_remotely',\n        'create_sessions',\n        'join_sessions',\n    ],\n    mod: [\n        'view_songs',\n        'edit_songs',\n        'create_songs',\n        'delete_songs',\n        'edit_chords',\n        'save_remotely',\n        'create_sessions',\n        'join_sessions',\n        'create_system_chords',\n        'create_system_instruments',\n        'moderate_content',\n    ],\n};\n// ============================================================================\n// Permission Checking Functions\n// ============================================================================\n/**\n * Check if a user has a specific permission\n */\nexport function hasPermission(user, permission) {\n    if (!user)\n        return false;\n    // Check if subscription has expired\n    if (user.subscriptionExpiresAt && new Date() > user.subscriptionExpiresAt) {\n        // Expired subscription falls back to free tier\n        return TIER_PERMISSIONS.free.includes(permission);\n    }\n    const tierPermissions = TIER_PERMISSIONS[user.subscriptionTier];\n    return tierPermissions.includes(permission);\n}\n/**\n * Check if a user has all of the specified permissions\n */\nexport function hasAllPermissions(user, permissions) {\n    return permissions.every(p => hasPermission(user, p));\n}\n/**\n * Check if a user has any of the specified permissions\n */\nexport function hasAnyPermission(user, permissions) {\n    return permissions.some(p => hasPermission(user, p));\n}\n/**\n * Get all permissions for a user's current tier\n */\nexport function getUserPermissions(user) {\n    if (!user)\n        return [];\n    // Check if subscription has expired\n    if (user.subscriptionExpiresAt && new Date() > user.subscriptionExpiresAt) {\n        return [...TIER_PERMISSIONS.free];\n    }\n    return [...TIER_PERMISSIONS[user.subscriptionTier]];\n}\n/**\n * Get the effective subscription tier for a user (accounting for expiration)\n */\nexport function getEffectiveTier(user) {\n    if (!user)\n        return 'free';\n    if (user.subscriptionExpiresAt && new Date() > user.subscriptionExpiresAt) {\n        return 'free';\n    }\n    return user.subscriptionTier;\n}\nexport const TIER_INFO = {\n    free: {\n        name: 'free',\n        displayName: 'Free',\n        description: 'View and browse songs',\n        features: [\n            'View all songs in your library',\n            'Join shared sessions',\n            'Basic chord viewing',\n        ],\n    },\n    basic: {\n        name: 'basic',\n        displayName: 'Basic',\n        description: 'Full editing capabilities',\n        features: [\n            'Everything in Free',\n            'Create and edit songs',\n            'Custom chord fingerings',\n            'Cloud backup and sync',\n        ],\n        price: '$4.99/month',\n    },\n    pro: {\n        name: 'pro',\n        displayName: 'Pro',\n        description: 'Host sessions and collaborate',\n        features: [\n            'Everything in Basic',\n            'Create and host shared sessions',\n            'Real-time collaboration',\n            'Session management tools',\n        ],\n        price: '$9.99/month',\n    },\n    mod: {\n        name: 'mod',\n        displayName: 'Moderator',\n        description: 'Community contributor',\n        features: [\n            'Everything in Pro',\n            'Create system-default chords',\n            'Create system instruments',\n            'Content moderation tools',\n        ],\n    },\n};\n/**\n * Get required tier for a specific permission\n */\nexport function getRequiredTierForPermission(permission) {\n    for (const tier of ['free', 'basic', 'pro', 'mod']) {\n        if (TIER_PERMISSIONS[tier].includes(permission)) {\n            return tier;\n        }\n    }\n    return 'mod'; // Highest tier if not found\n}\n/**\n * Check if user can upgrade to a higher tier\n */\nexport function canUpgrade(user) {\n    if (!user)\n        return true;\n    return user.subscriptionTier !== 'mod';\n}\n/**\n * Get the next tier for upgrade\n */\nexport function getNextTier(currentTier) {\n    const tiers = ['free', 'basic', 'pro', 'mod'];\n    const currentIndex = tiers.indexOf(currentTier);\n    if (currentIndex < tiers.length - 1) {\n        return tiers[currentIndex + 1];\n    }\n    return null;\n}\n//# sourceMappingURL=permissions.js.map"],"names":["TIER_PERMISSIONS","hasPermission","user","permission","hasAllPermissions","permissions","p","hasAnyPermission","getUserPermissions","getEffectiveTier","TIER_INFO","getRequiredTierForPermission","tier","canUpgrade","getNextTier","currentTier","tiers","currentIndex"],"mappings":"AAYA,MAAMA,EAAmB,CACrB,KAAM,CACF,aACA,eACR,EACI,MAAO,CACH,aACA,aACA,eACA,eACA,cACA,gBACA,eACR,EACI,IAAK,CACD,aACA,aACA,eACA,eACA,cACA,gBACA,kBACA,eACR,EACI,IAAK,CACD,aACA,aACA,eACA,eACA,cACA,gBACA,kBACA,gBACA,uBACA,4BACA,kBACR,CACA,EAOO,SAASC,EAAcC,EAAMC,EAAY,CAC5C,OAAKD,EAGDA,EAAK,uBAAyB,IAAI,KAASA,EAAK,sBAEzCF,EAAiB,KAAK,SAASG,CAAU,EAE5BH,EAAiBE,EAAK,gBAAgB,EACvC,SAASC,CAAU,EAP/B,EAQf,CAIO,SAASC,EAAkBF,EAAMG,EAAa,CACjD,OAAOA,EAAY,MAAMC,GAAKL,EAAcC,EAAMI,CAAC,CAAC,CACxD,CAIO,SAASC,EAAiBL,EAAMG,EAAa,CAChD,OAAOA,EAAY,KAAKC,GAAKL,EAAcC,EAAMI,CAAC,CAAC,CACvD,CAIO,SAASE,EAAmBN,EAAM,CACrC,OAAKA,EAGDA,EAAK,uBAAyB,IAAI,KAASA,EAAK,sBACzC,CAAC,GAAGF,EAAiB,IAAI,EAE7B,CAAC,GAAGA,EAAiBE,EAAK,gBAAgB,CAAC,EALvC,CAAA,CAMf,CAIO,SAASO,EAAiBP,EAAM,CAGnC,MAFI,CAACA,GAEDA,EAAK,uBAAyB,IAAI,KAASA,EAAK,sBACzC,OAEJA,EAAK,gBAChB,CACY,MAACQ,EAAY,CACrB,KAAM,CACF,KAAM,OACN,YAAa,OACb,YAAa,wBACb,SAAU,CACN,iCACA,uBACA,qBACZ,CACA,EACI,MAAO,CACH,KAAM,QACN,YAAa,QACb,YAAa,4BACb,SAAU,CACN,qBACA,wBACA,0BACA,uBACZ,EACQ,MAAO,aACf,EACI,IAAK,CACD,KAAM,MACN,YAAa,MACb,YAAa,gCACb,SAAU,CACN,sBACA,kCACA,0BACA,0BACZ,EACQ,MAAO,aACf,EACI,IAAK,CACD,KAAM,MACN,YAAa,YACb,YAAa,wBACb,SAAU,CACN,oBACA,+BACA,4BACA,0BACZ,CACA,CACA,EAIO,SAASC,EAA6BR,EAAY,CACrD,UAAWS,IAAQ,CAAC,OAAQ,QAAS,MAAO,KAAK,EAC7C,GAAIZ,EAAiBY,CAAI,EAAE,SAAST,CAAU,EAC1C,OAAOS,EAGf,MAAO,KACX,CAIO,SAASC,EAAWX,EAAM,CAC7B,OAAKA,EAEEA,EAAK,mBAAqB,MADtB,EAEf,CAIO,SAASY,EAAYC,EAAa,CACrC,MAAMC,EAAQ,CAAC,OAAQ,QAAS,MAAO,KAAK,EACtCC,EAAeD,EAAM,QAAQD,CAAW,EAC9C,OAAIE,EAAeD,EAAM,OAAS,EACvBA,EAAMC,EAAe,CAAC,EAE1B,IACX"}