const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DhSYb-d6.js","../chunks/Cpj98o6Y.js","../chunks/CDUSxSYR.js","../chunks/CKx7fsl1.js"])))=>i.map(i=>d[i]);
import{V as Ze,W as O,c as _e,X as je,a3 as X,Y as qe,_ as q,b as e,a5 as Ce,s as n,a7 as He,a0 as c,$ as Je,Z as o,a1 as r,a4 as Ke,a2 as z}from"../chunks/cnc2SBSL.js";import{d as Qe,f as d,a as l,c as fe,s as w,e as C}from"../chunks/Caf-0pf-.js";import{i as g,b as Ue}from"../chunks/Coh7MiEg.js";import{h as et,e as pe}from"../chunks/ClOXSIRR.js";import{s as ue}from"../chunks/L9orpk0O.js";import{s as tt}from"../chunks/oTU1mMgh.js";import{s as at,a as st}from"../chunks/C8OxQ71e.js";import{p as rt}from"../chunks/DSNcCDqV.js";import"../chunks/BJEHMrWO.js";var ot=d('<div class="loading svelte-1izxbfe">Loading set...</div>'),it=d('<div class="error-container svelte-1izxbfe"><p> </p> <a href="/sets" class="btn btn-secondary">Back to Sets</a></div>'),nt=d('<span class="setlist-badge svelte-1izxbfe">Setlist</span>'),lt=d('<p class="set-description svelte-1izxbfe"> </p>'),vt=d('<div class="empty-state svelte-1izxbfe"><p class="svelte-1izxbfe">No songs in this set yet.</p> <button class="btn btn-primary">Add Songs</button></div>'),dt=d('<span class="drag-hint svelte-1izxbfe">Drag to reorder</span>'),ct=d('<span class="song-number svelte-1izxbfe"> </span>'),_t=d('<span class="song-artist svelte-1izxbfe"> </span>'),ft=d('<span class="song-key svelte-1izxbfe"> </span>'),pt=d('<li><!> <a class="song-link svelte-1izxbfe"><div class="song-info svelte-1izxbfe"><span class="song-title svelte-1izxbfe"> </span> <!></div> <div class="song-meta"><!></div></a> <button class="btn-remove svelte-1izxbfe" title="Remove from set">×</button></li>'),ut=d('<div class="song-list-header svelte-1izxbfe"><span class="song-count svelte-1izxbfe"> </span> <!></div> <ul class="song-list svelte-1izxbfe"></ul>',1),gt=d('<header class="page-header svelte-1izxbfe"><div class="header-left svelte-1izxbfe"><a href="/sets" class="back-link svelte-1izxbfe">← Back to Sets</a> <h1> </h1> <!> <!></div> <button class="btn btn-primary">+ Add Songs</button></header> <!>',1),bt=d('<p class="empty-message svelte-1izxbfe">All your songs are already in this set!</p>'),mt=d('<span class="song-artist svelte-1izxbfe"> </span>'),St=d('<li class="available-song-item svelte-1izxbfe"><div class="song-info svelte-1izxbfe"><span class="song-title svelte-1izxbfe"> </span> <!></div> <button class="btn btn-primary btn-sm svelte-1izxbfe">Add</button></li>'),yt=d('<ul class="available-songs svelte-1izxbfe"></ul>'),ht=d('<div class="modal-overlay svelte-1izxbfe"><div class="modal svelte-1izxbfe"><h2 class="svelte-1izxbfe">Add Songs to Set</h2> <!> <div class="modal-actions svelte-1izxbfe"><button class="btn btn-secondary">Done</button></div></div></div>'),xt=d('<main class="container"><!></main> <!>',1);function $t(ge,be){Ze(be,!0);const me=()=>st(rt,"$page",Se),[Se,ye]=at();let a=O(null),T=O(_e([])),y=O(_e([])),H=O(!0),Y=O(null),re=!1,V=O(!1),E=O(null);const he=Ce(()=>me().params.id);je(()=>{!Ue||re||(re=!0,oe())});async function oe(){try{const{SongSetRepository:t,SongRepository:s,getDatabase:i}=await q(async()=>{const{SongSetRepository:v,SongRepository:m,getDatabase:f}=await import("../chunks/DhSYb-d6.js");return{SongSetRepository:v,SongRepository:m,getDatabase:f}},__vite__mapDeps([0,1,2,3]),import.meta.url),b=i(),x=await t.getById(e(he));if(!x){n(Y,"Set not found"),n(H,!1);return}n(a,x,!0);const u=await b.users.toArray();u.length>0&&n(T,await s.getByOwner(u[0].id),!0),n(y,e(a).songIds.map(v=>e(T).find(m=>m.id===v)).filter(v=>v!==void 0),!0)}catch(t){console.error("Failed to load set:",t),n(Y,t instanceof Error?t.message:"Failed to load set",!0)}finally{n(H,!1)}}async function xe(t){if(e(a))try{const{SongSetRepository:s}=await q(async()=>{const{SongSetRepository:b}=await import("../chunks/DhSYb-d6.js");return{SongSetRepository:b}},__vite__mapDeps([0,1,2,3]),import.meta.url);await s.addSong(e(a).id,t),n(a,{...e(a),songIds:[...e(a).songIds,t]},!0);const i=e(T).find(b=>b.id===t);i&&n(y,[...e(y),i],!0)}catch(s){console.error("Failed to add song:",s)}}async function ze(t){if(e(a))try{const{SongSetRepository:s}=await q(async()=>{const{SongSetRepository:i}=await import("../chunks/DhSYb-d6.js");return{SongSetRepository:i}},__vite__mapDeps([0,1,2,3]),import.meta.url);await s.removeSong(e(a).id,t),n(a,{...e(a),songIds:e(a).songIds.filter(i=>i!==t)},!0),n(y,e(y).filter(i=>i.id!==t),!0)}catch(s){console.error("Failed to remove song:",s)}}async function we(t,s){if(!e(a)||t===s)return;const i=[...e(a).songIds],[b]=i.splice(t,1);i.splice(s,0,b);const x=[...e(y)],[u]=x.splice(t,1);x.splice(s,0,u),n(a,{...e(a),songIds:i},!0),n(y,x,!0);try{const{SongSetRepository:v}=await q(async()=>{const{SongSetRepository:m}=await import("../chunks/DhSYb-d6.js");return{SongSetRepository:m}},__vite__mapDeps([0,1,2,3]),import.meta.url);await v.reorderSongs(e(a).id,i)}catch(v){console.error("Failed to reorder songs:",v),await oe()}}function ke(t){n(E,t,!0)}function Re(t,s){t.preventDefault()}function De(t,s){t.preventDefault(),e(E)!==null&&e(E)!==s&&we(e(E),s),n(E,null)}function Ae(){n(E,null)}function ie(){return e(a)?e(T).filter(t=>!e(a).songIds.includes(t.id)):e(T)}var ne=xt();et("1izxbfe",t=>{He(()=>{Je.title=`${e(a)?.name??"Loading..."??""} - Gigwidget`})});var J=X(ne),Ee=o(J);{var Ie=t=>{var s=ot();l(t,s)},Le=t=>{var s=fe(),i=X(s);{var b=u=>{var v=it(),m=o(v),f=o(m,!0);r(m),Ke(2),r(v),z(()=>w(f,e(Y))),l(u,v)},x=u=>{var v=fe(),m=X(v);{var f=k=>{var P=gt(),A=X(P),I=o(A),L=c(o(I),2),B=o(L,!0);r(L);var Z=c(L,2);{var K=p=>{var S=nt();l(p,S)};g(Z,p=>{e(a).isSetlist&&p(K)})}var Q=c(Z,2);{var U=p=>{var S=lt(),$=o(S,!0);r(S),z(()=>w($,e(a).description)),l(p,S)};g(Q,p=>{e(a).description&&p(U)})}r(I);var G=c(I,2);G.__click=()=>n(V,!0),r(A);var M=c(A,2);{var ee=p=>{var S=vt(),$=c(o(S),2);$.__click=()=>n(V,!0),r(S),l(p,S)},Oe=p=>{var S=ut(),$=X(S),te=o($),Pe=o(te);r(te);var Te=c(te,2);{var Ve=F=>{var R=dt();l(F,R)};g(Te,F=>{e(a).isSetlist&&F(Ve)})}r($);var le=c($,2);pe(le,23,()=>e(y),F=>F.id,(F,R,N)=>{var D=pt();let ve;var de=o(D);{var Be=_=>{var h=ct(),W=o(h,!0);r(h),z(()=>w(W,e(N)+1)),l(_,h)};g(de,_=>{e(a).isSetlist&&_(Be)})}var j=c(de,2),ae=o(j),se=o(ae),Ge=o(se,!0);r(se);var Me=c(se,2);{var Ne=_=>{var h=_t(),W=o(h,!0);r(h),z(()=>w(W,e(R).artist)),l(_,h)};g(Me,_=>{e(R).artist&&_(Ne)})}r(ae);var ce=c(ae,2),We=o(ce);{var Xe=_=>{var h=ft(),W=o(h,!0);r(h),z(()=>w(W,e(R).key)),l(_,h)};g(We,_=>{e(R).key&&_(Xe)})}r(ce),r(j);var Ye=c(j,2);Ye.__click=()=>ze(e(R).id),r(D),z(()=>{ve=tt(D,1,"song-item svelte-1izxbfe",null,ve,{dragging:e(E)===e(N)}),ue(D,"draggable",e(a).isSetlist),ue(j,"href",`/songs/${e(R).id??""}`),w(Ge,e(R).title)}),C("dragstart",D,()=>ke(e(N))),C("dragover",D,_=>Re(_,e(N))),C("drop",D,_=>De(_,e(N))),C("dragend",D,Ae),l(F,D)}),r(le),z(()=>w(Pe,`${e(y).length??""} song${e(y).length!==1?"s":""}`)),l(p,S)};g(M,p=>{e(y).length===0?p(ee):p(Oe,!1)})}z(()=>w(B,e(a).name)),l(k,P)};g(m,k=>{e(a)&&k(f)},!0)}l(u,v)};g(i,u=>{e(Y)?u(b):u(x,!1)},!0)}l(t,s)};g(Ee,t=>{e(H)?t(Ie):t(Le,!1)})}r(J);var $e=c(J,2);{var Fe=t=>{var s=ht();s.__click=()=>n(V,!1);var i=o(s);i.__click=f=>f.stopPropagation();var b=c(o(i),2);{var x=f=>{var k=bt();l(f,k)},u=f=>{var k=yt();pe(k,21,ie,P=>P.id,(P,A)=>{var I=St(),L=o(I),B=o(L),Z=o(B,!0);r(B);var K=c(B,2);{var Q=G=>{var M=mt(),ee=o(M,!0);r(M),z(()=>w(ee,e(A).artist)),l(G,M)};g(K,G=>{e(A).artist&&G(Q)})}r(L);var U=c(L,2);U.__click=()=>xe(e(A).id),r(I),z(()=>w(Z,e(A).title)),l(P,I)}),r(k),l(f,k)};g(b,f=>{ie().length===0?f(x):f(u,!1)})}var v=c(b,2),m=o(v);m.__click=()=>n(V,!1),r(v),r(i),r(s),l(t,s)};g($e,t=>{e(V)&&t(Fe)})}l(ge,ne),qe(),ye()}Qe(["click"]);export{$t as component};
//# sourceMappingURL=8.CeliEOrX.js.map
