const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/DhSYb-d6.js","../chunks/Cpj98o6Y.js","../chunks/CDUSxSYR.js","../chunks/CKx7fsl1.js","../chunks/BfUQ7lDy.js","../chunks/C6md0y2C.js","../chunks/DLo10Bg_.js"])))=>i.map(i=>d[i]);
import{V as Ve,W as d,c as pe,X as je,a3 as fe,Y as Ne,_ as B,s as a,b as e,x as Ue,a0 as i,Z as r,$ as We,a1 as o,a4 as me,a2 as R}from"../chunks/cnc2SBSL.js";import{d as Ge,f as u,a as v,c as Xe,s as P,t as he}from"../chunks/Caf-0pf-.js";import{i as g,b as Ye}from"../chunks/Coh7MiEg.js";import{h as Ze,e as ge}from"../chunks/ClOXSIRR.js";import{r as ie,a as Be,s as Ke}from"../chunks/L9orpk0O.js";import{s as $e}from"../chunks/oTU1mMgh.js";import{a as es,b as ss}from"../chunks/_dvcZOuR.js";import{h as ze}from"../chunks/Dyjw1x4N.js";var as=u('<div class="loading svelte-1jobjz3">Loading...</div>'),ts=u('<div class="qr-section svelte-1jobjz3"><h3 class="svelte-1jobjz3">Scan to Join</h3> <img alt="Session QR Code" class="qr-code svelte-1jobjz3"/> <p class="qr-hint svelte-1jobjz3">Others can scan this QR code to join your session</p></div>'),os=u('<span class="song-artist svelte-1jobjz3"> </span>'),rs=u('<li class="song-item svelte-1jobjz3"><span class="song-title svelte-1jobjz3"> </span> <!></li>'),ns=u('<div class="shared-songs svelte-1jobjz3"><h3 class="svelte-1jobjz3"> </h3> <ul class="song-list svelte-1jobjz3"></ul></div>'),is=u('<div class="active-session svelte-1jobjz3"><div class="session-status svelte-1jobjz3"><span></span> <span class="status-text svelte-1jobjz3"><!></span> <span class="peer-count svelte-1jobjz3"> </span></div> <!> <!> <button class="btn btn-danger svelte-1jobjz3"> </button></div>'),ls=u('<button class="option-card svelte-1jobjz3"><span class="option-icon svelte-1jobjz3">üì°</span> <span class="option-title svelte-1jobjz3">Start Session</span> <span class="option-desc svelte-1jobjz3">Host a session and share your songs</span></button>'),cs=u('<div class="option-card disabled svelte-1jobjz3"><span class="option-icon svelte-1jobjz3">üì°</span> <span class="option-title svelte-1jobjz3">Start Session</span> <span class="option-desc svelte-1jobjz3">Requires Pro subscription</span> <a href="/account" class="upgrade-link svelte-1jobjz3">Upgrade</a></div>'),vs=u('<div class="session-options svelte-1jobjz3"><!> <button class="option-card svelte-1jobjz3"><span class="option-icon svelte-1jobjz3">üì±</span> <span class="option-title svelte-1jobjz3">Join Session</span> <span class="option-desc svelte-1jobjz3">Scan a QR code to join</span></button></div>'),ds=u('<label class="song-checkbox svelte-1jobjz3"><input type="checkbox" class="svelte-1jobjz3"/> <span> </span></label>'),us=u('<div class="form-group svelte-1jobjz3"><label class="svelte-1jobjz3">Select songs to share:</label> <div class="song-selector svelte-1jobjz3"></div></div>'),bs=u('<div class="modal-overlay svelte-1jobjz3"><div class="modal svelte-1jobjz3"><h2 class="svelte-1jobjz3">Start Sharing Session</h2> <div class="form-group svelte-1jobjz3"><label class="checkbox-label svelte-1jobjz3"><input type="checkbox" class="svelte-1jobjz3"/> Share all songs</label></div> <!> <div class="form-group svelte-1jobjz3"><label for="password" class="svelte-1jobjz3">Password (optional)</label> <input type="password" id="password" placeholder="Leave empty for open session"/></div> <div class="modal-actions svelte-1jobjz3"><button class="btn btn-secondary">Cancel</button> <button class="btn btn-primary"> </button></div></div></div>'),_s=u('<div class="error-message svelte-1jobjz3"> </div>'),ps=u('<button class="btn btn-primary">Start Camera</button>'),js=u(`<p class="scan-hint svelte-1jobjz3">Point your camera at the host's QR code</p>`),fs=u('<div class="modal-overlay svelte-1jobjz3"><div class="modal modal-large svelte-1jobjz3"><h2 class="svelte-1jobjz3">Join Session</h2> <!> <div id="qr-reader" class="qr-reader svelte-1jobjz3"></div> <!> <div class="modal-actions svelte-1jobjz3"><button class="btn btn-secondary">Cancel</button></div></div></div>'),ms=u('<main class="container"><header class="page-header svelte-1jobjz3"><div class="header-left svelte-1jobjz3"><a href="/" class="back-link svelte-1jobjz3">‚Üê Home</a> <h1>Sharing Session</h1> <p class="subtitle svelte-1jobjz3">Share songs with nearby musicians in real-time</p></div></header> <!></main> <!> <!>',1);function Rs(ye,Se){Ve(Se,!0);let q=d(null),U=d(pe([])),le=d(!0),ce=!1,ve=d(!1),we=d(!1),_=null,W=d(null),A=d(!1),G=d(0),L=d("disconnected"),M=d(null),X=d(null),C=d(!1),E=d(null),Y=d(!1),J=d(!1),k=d(pe([])),H=d(!0),K=d(""),Q=d(!1);je(()=>{!Ye||ce||(ce=!0,ke())}),je(()=>()=>{_&&_.destroy()});async function ke(){try{const{getDatabase:t}=await B(async()=>{const{getDatabase:y}=await import("../chunks/DhSYb-d6.js");return{getDatabase:y}},__vite__mapDeps([0,1,2,3]),import.meta.url),s=t(),n=await s.users.toArray();n.length>0&&(a(q,n[0],!0),a(U,await s.songs.where({ownerId:e(q).id}).toArray(),!0),a(ve,ze(e(q),"create_sessions"),!0),a(we,ze(e(q),"join_sessions"),!0))}catch(t){console.error("Failed to load data:",t)}finally{a(le,!1)}}async function de(){if(!(_||!e(q)))try{const{SessionManager:t}=await B(async()=>{const{SessionManager:s}=await import("../chunks/BfUQ7lDy.js");return{SessionManager:s}},__vite__mapDeps([4,3,1,5,2]),import.meta.url);_=new t({user:e(q)}),_.on("session-created",({session:s,qrPayload:n})=>{a(W,s,!0),a(M,n,!0),a(A,!0),a(L,"connected"),xe(n)}),_.on("session-joined",({session:s})=>{a(W,s,!0),a(A,!1),a(L,"connected"),a(C,!1)}),_.on("session-left",()=>{a(W,null),a(M,null),a(X,null),a(A,!1),a(G,0),a(L,"disconnected")}),_.on("peers-changed",({count:s})=>{a(G,s,!0)}),_.on("sync-status",({synced:s})=>{a(L,s?"connected":"connecting",!0)})}catch(t){console.error("Failed to init session manager:",t)}}async function xe(t){try{const{generateSessionQR:s}=await B(async()=>{const{generateSessionQR:n}=await import("../chunks/BfUQ7lDy.js");return{generateSessionQR:n}},__vite__mapDeps([4,3,1,5,2]),import.meta.url);a(X,await s(t),!0)}catch(s){console.error("Failed to generate QR code:",s)}}async function Re(){if(await de(),!(!_||!e(q))){a(Q,!0);try{const t=(e(H)?e(U):e(U).filter(s=>e(k).includes(s.id))).map(s=>({id:s.id,title:s.title,artist:s.artist,key:s.key,updatedAt:s.updatedAt.getTime()}));await _.createSession(t,{type:"webrtc",libraryScope:e(H)?"full":"selected",selectedSongIds:e(H)?void 0:e(k),password:e(K)||void 0}),a(J,!1)}catch(t){console.error("Failed to start session:",t)}finally{a(Q,!1)}}}async function Pe(){a(Y,!0),a(E,null);try{const{Html5QrcodeScanner:t}=await B(async()=>{const{Html5QrcodeScanner:n}=await import("../chunks/DLo10Bg_.js");return{Html5QrcodeScanner:n}},__vite__mapDeps([6,1]),import.meta.url),s=new t("qr-reader",{fps:10,qrbox:{width:250,height:250}},!1);s.render(async n=>{s.clear(),await Qe(n)},n=>{console.warn("QR scan error:",n)})}catch(t){console.error("Failed to start QR scanner:",t),a(E,"Failed to access camera"),a(Y,!1)}}async function Qe(t){a(Y,!1),a(E,null);try{const s=JSON.parse(t);if(await de(),!_){a(E,"Session manager not ready");return}await _.joinSession({payload:s})}catch(s){console.error("Failed to join session:",s),a(E,s instanceof Error?s.message:"Failed to join session",!0)}}async function qe(){_&&await _.leaveSession()}function Ee(t){e(k).includes(t)?a(k,e(k).filter(s=>s!==t),!0):a(k,[...e(k),t],!0)}var ue=ms();Ze("1jobjz3",t=>{Ue(()=>{We.title="Sharing Session - Gigwidget"})});var $=fe(ue),He=i(r($),2);{var Ae=t=>{var s=as();v(t,s)},Me=t=>{var s=Xe(),n=fe(s);{var y=j=>{var m=is(),S=r(m),z=r(S);let w;var l=i(z,2),c=r(l);{var f=b=>{var p=he("Hosting Session");v(b,p)},ee=b=>{var p=he();R(()=>P(p,`Connected to ${e(M)?.hostName??"Host"??""}`)),v(b,p)};g(c,b=>{e(A)?b(f):b(ee,!1)})}o(l);var h=i(l,2),O=r(h);o(h),o(S);var I=i(S,2);{var T=b=>{var p=ts(),N=i(r(p),2);me(2),o(p),R(()=>Ke(N,"src",e(X))),v(b,p)};g(I,b=>{e(A)&&e(X)&&b(T)})}var F=i(I,2);{var V=b=>{var p=ns(),N=r(p),Ce=r(N);o(N);var _e=i(N,2);ge(_e,21,()=>e(M).libraryManifest,se=>se.id,(se,ae)=>{var te=rs(),oe=r(te),Je=r(oe,!0);o(oe);var Oe=i(oe,2);{var Ie=re=>{var ne=os(),Te=r(ne,!0);o(ne),R(()=>P(Te,e(ae).artist)),v(re,ne)};g(Oe,re=>{e(ae).artist&&re(Ie)})}o(te),R(()=>P(Je,e(ae).title)),v(se,te)}),o(_e),o(p),R(()=>P(Ce,`Shared Songs (${e(M).libraryManifest.length??""})`)),v(b,p)};g(F,b=>{e(M)?.libraryManifest&&b(V)})}var x=i(F,2);x.__click=qe;var Z=r(x,!0);o(x),o(m),R(()=>{w=$e(z,1,"status-indicator svelte-1jobjz3",null,w,{connected:e(L)==="connected"}),P(O,`${e(G)??""} peer${e(G)!==1?"s":""}`),P(Z,e(A)?"End Session":"Leave Session")}),v(j,m)},D=j=>{var m=vs(),S=r(m);{var z=c=>{var f=ls();f.__click=()=>a(J,!0),v(c,f)},w=c=>{var f=cs();v(c,f)};g(S,c=>{e(ve)?c(z):c(w,!1)})}var l=i(S,2);l.__click=()=>a(C,!0),o(m),v(j,m)};g(n,j=>{e(W)?j(y):j(D,!1)},!0)}v(t,s)};g(He,t=>{e(le)?t(Ae):t(Me,!1)})}o($);var be=i($,2);{var De=t=>{var s=bs();s.__click=()=>a(J,!1);var n=r(s);n.__click=h=>h.stopPropagation();var y=i(r(n),2),D=r(y),j=r(D);ie(j),me(),o(D),o(y);var m=i(y,2);{var S=h=>{var O=us(),I=i(r(O),2);ge(I,21,()=>e(U),T=>T.id,(T,F)=>{var V=ds(),x=r(V);ie(x),x.__change=()=>Ee(e(F).id);var Z=i(x,2),b=r(Z,!0);o(Z),o(V),R(p=>{Be(x,p),x.disabled=e(Q),P(b,e(F).title)},[()=>e(k).includes(e(F).id)]),v(T,V)}),o(I),o(O),v(h,O)};g(m,h=>{e(H)||h(S)})}var z=i(m,2),w=i(r(z),2);ie(w),o(z);var l=i(z,2),c=r(l);c.__click=()=>a(J,!1);var f=i(c,2);f.__click=Re;var ee=r(f,!0);o(f),o(l),o(n),o(s),R(()=>{j.disabled=e(Q),w.disabled=e(Q),c.disabled=e(Q),f.disabled=e(Q)||!e(H)&&e(k).length===0,P(ee,e(Q)?"Starting...":"Start Session")}),es(j,()=>e(H),h=>a(H,h)),ss(w,()=>e(K),h=>a(K,h)),v(t,s)};g(be,t=>{e(J)&&t(De)})}var Fe=i(be,2);{var Le=t=>{var s=fs();s.__click=()=>a(C,!1);var n=r(s);n.__click=l=>l.stopPropagation();var y=i(r(n),2);{var D=l=>{var c=_s(),f=r(c,!0);o(c),R(()=>P(f,e(E))),v(l,c)};g(y,l=>{e(E)&&l(D)})}var j=i(y,4);{var m=l=>{var c=ps();c.__click=Pe,v(l,c)},S=l=>{var c=js();v(l,c)};g(j,l=>{e(Y)?l(S,!1):l(m)})}var z=i(j,2),w=r(z);w.__click=()=>a(C,!1),o(z),o(n),o(s),v(t,s)};g(Fe,t=>{e(C)&&t(Le)})}v(ye,ue),Ne()}Ge(["click","change"]);export{Rs as component};
//# sourceMappingURL=6.Day0pw_S.js.map
