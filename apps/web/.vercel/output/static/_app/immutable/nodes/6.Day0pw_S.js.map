{"version":3,"mappings":"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","names":["user","$.state","songs","$.proxy","loading","hasLoaded","canHost","canJoin","sessionManager","activeSession","isHosting","peerCount","syncStatus","qrPayload","qrDataUrl","showJoinModal","joinError","scanning","showHostModal","selectedSongIds","shareAll","sessionPassword","creating","$.user_effect","browser","loadData","getDatabase","db","users","$.set","$.get","hasPermission","err","initSessionManager","SessionManager","session","payload","generateQRCode","count","synced","generateSessionQR","startHosting","manifest","joinWithQR","Html5QrcodeScanner","scanner","decodedText","processQRPayload","error","data","leaveSession","toggleSongSelection","songId","id","$.head","$$anchor","main","$.first_child","fragment","div","root_2","div_1","root_4","div_2","span","span_1","$$render","consequent_1","alternate","span_2","div_3","root_7","img","$.template_effect","$.set_attribute","consequent_2","div_4","root_8","h3","ul","song","li","root_9","span_3","span_4","root_10","$.set_text","text_5","consequent_3","text_4","consequent_4","button","$.sibling","node_4","classes","text_2","div_5","root_11","button_1","root_12","div_6","root_13","consequent_6","alternate_1","button_2","node_6","consequent_5","alternate_2","consequent","alternate_3","div_7","root_14","div_8","e","div_9","label","input","div_10","root_15","div_11","label_1","root_16","input_1","$.child","$.remove_input_defaults","span_5","$.set_checked","$0","text_7","consequent_7","div_12","node_8","input_2","div_13","button_3","button_4","text_8","$.reset","$$value","consequent_8","div_14","root_17","div_15","div_16","root_18","consequent_9","button_5","root_19","p","root_20","alternate_4","consequent_10","div_17","node_11","button_6","consequent_11"],"ignoreList":[],"sources":["../../../../../../src/routes/session/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { browser } from '$app/environment';\n  import type { User, Song, QRSessionPayload, SongManifestEntry } from '@gigwidget/core';\n  import { hasPermission } from '@gigwidget/core';\n\n  let user = $state<User | null>(null);\n  let songs = $state<Song[]>([]);\n  let loading = $state(true);\n  let hasLoaded = false;\n\n  // Permission state\n  let canHost = $state(false);\n  let canJoin = $state(false);\n\n  // Session state\n  let sessionManager: any = null;\n  let activeSession = $state<any>(null);\n  let isHosting = $state(false);\n  let peerCount = $state(0);\n  let syncStatus = $state<'connected' | 'connecting' | 'disconnected'>('disconnected');\n  let qrPayload = $state<QRSessionPayload | null>(null);\n  let qrDataUrl = $state<string | null>(null);\n\n  // Join modal\n  let showJoinModal = $state(false);\n  let joinError = $state<string | null>(null);\n  let scanning = $state(false);\n\n  // Host modal\n  let showHostModal = $state(false);\n  let selectedSongIds = $state<string[]>([]);\n  let shareAll = $state(true);\n  let sessionPassword = $state('');\n  let creating = $state(false);\n\n  $effect(() => {\n    if (!browser || hasLoaded) return;\n    hasLoaded = true;\n    loadData();\n  });\n\n  // Cleanup on destroy\n  $effect(() => {\n    return () => {\n      if (sessionManager) {\n        sessionManager.destroy();\n      }\n    };\n  });\n\n  async function loadData() {\n    try {\n      const { getDatabase } = await import('@gigwidget/db');\n      const db = getDatabase();\n\n      const users = await db.users.toArray();\n      if (users.length > 0) {\n        user = users[0];\n        songs = await db.songs.where({ ownerId: user.id }).toArray();\n        canHost = hasPermission(user, 'create_sessions');\n        canJoin = hasPermission(user, 'join_sessions');\n      }\n    } catch (err) {\n      console.error('Failed to load data:', err);\n    } finally {\n      loading = false;\n    }\n  }\n\n  async function initSessionManager() {\n    if (sessionManager || !user) return;\n\n    try {\n      const { SessionManager } = await import('@gigwidget/sync');\n\n      sessionManager = new SessionManager({ user });\n\n      sessionManager.on('session-created', ({ session, qrPayload: payload }: any) => {\n        activeSession = session;\n        qrPayload = payload;\n        isHosting = true;\n        syncStatus = 'connected';\n        generateQRCode(payload);\n      });\n\n      sessionManager.on('session-joined', ({ session }: any) => {\n        activeSession = session;\n        isHosting = false;\n        syncStatus = 'connected';\n        showJoinModal = false;\n      });\n\n      sessionManager.on('session-left', () => {\n        activeSession = null;\n        qrPayload = null;\n        qrDataUrl = null;\n        isHosting = false;\n        peerCount = 0;\n        syncStatus = 'disconnected';\n      });\n\n      sessionManager.on('peers-changed', ({ count }: any) => {\n        peerCount = count;\n      });\n\n      sessionManager.on('sync-status', ({ synced }: any) => {\n        syncStatus = synced ? 'connected' : 'connecting';\n      });\n    } catch (err) {\n      console.error('Failed to init session manager:', err);\n    }\n  }\n\n  async function generateQRCode(payload: QRSessionPayload) {\n    try {\n      const { generateSessionQR } = await import('@gigwidget/sync');\n      qrDataUrl = await generateSessionQR(payload);\n    } catch (err) {\n      console.error('Failed to generate QR code:', err);\n    }\n  }\n\n  async function startHosting() {\n    await initSessionManager();\n    if (!sessionManager || !user) return;\n\n    creating = true;\n    try {\n      const manifest: SongManifestEntry[] = (shareAll ? songs : songs.filter((s) => selectedSongIds.includes(s.id))).map(\n        (s) => ({\n          id: s.id,\n          title: s.title,\n          artist: s.artist,\n          key: s.key,\n          updatedAt: s.updatedAt.getTime(),\n        })\n      );\n\n      await sessionManager.createSession(manifest, {\n        type: 'webrtc',\n        libraryScope: shareAll ? 'full' : 'selected',\n        selectedSongIds: shareAll ? undefined : selectedSongIds,\n        password: sessionPassword || undefined,\n      });\n\n      showHostModal = false;\n    } catch (err) {\n      console.error('Failed to start session:', err);\n    } finally {\n      creating = false;\n    }\n  }\n\n  async function joinWithQR() {\n    scanning = true;\n    joinError = null;\n\n    try {\n      const { Html5QrcodeScanner } = await import('html5-qrcode');\n\n      const scanner = new Html5QrcodeScanner(\n        'qr-reader',\n        { fps: 10, qrbox: { width: 250, height: 250 } },\n        false\n      );\n\n      scanner.render(\n        async (decodedText) => {\n          scanner.clear();\n          await processQRPayload(decodedText);\n        },\n        (error) => {\n          console.warn('QR scan error:', error);\n        }\n      );\n    } catch (err) {\n      console.error('Failed to start QR scanner:', err);\n      joinError = 'Failed to access camera';\n      scanning = false;\n    }\n  }\n\n  async function processQRPayload(data: string) {\n    scanning = false;\n    joinError = null;\n\n    try {\n      const payload: QRSessionPayload = JSON.parse(data);\n\n      await initSessionManager();\n      if (!sessionManager) {\n        joinError = 'Session manager not ready';\n        return;\n      }\n\n      await sessionManager.joinSession({ payload });\n    } catch (err) {\n      console.error('Failed to join session:', err);\n      joinError = err instanceof Error ? err.message : 'Failed to join session';\n    }\n  }\n\n  async function leaveSession() {\n    if (sessionManager) {\n      await sessionManager.leaveSession();\n    }\n  }\n\n  function toggleSongSelection(songId: string) {\n    if (selectedSongIds.includes(songId)) {\n      selectedSongIds = selectedSongIds.filter((id) => id !== songId);\n    } else {\n      selectedSongIds = [...selectedSongIds, songId];\n    }\n  }\n</script>\n\n<svelte:head>\n  <title>Sharing Session - Gigwidget</title>\n</svelte:head>\n\n<main class=\"container\">\n  <header class=\"page-header\">\n    <div class=\"header-left\">\n      <a href=\"/\" class=\"back-link\">‚Üê Home</a>\n      <h1>Sharing Session</h1>\n      <p class=\"subtitle\">Share songs with nearby musicians in real-time</p>\n    </div>\n  </header>\n\n  {#if loading}\n    <div class=\"loading\">Loading...</div>\n  {:else if activeSession}\n    <div class=\"active-session\">\n      <div class=\"session-status\">\n        <span class=\"status-indicator\" class:connected={syncStatus === 'connected'}></span>\n        <span class=\"status-text\">\n          {#if isHosting}\n            Hosting Session\n          {:else}\n            Connected to {qrPayload?.hostName ?? 'Host'}\n          {/if}\n        </span>\n        <span class=\"peer-count\">{peerCount} peer{peerCount !== 1 ? 's' : ''}</span>\n      </div>\n\n      {#if isHosting && qrDataUrl}\n        <div class=\"qr-section\">\n          <h3>Scan to Join</h3>\n          <img src={qrDataUrl} alt=\"Session QR Code\" class=\"qr-code\" />\n          <p class=\"qr-hint\">Others can scan this QR code to join your session</p>\n        </div>\n      {/if}\n\n      {#if qrPayload?.libraryManifest}\n        <div class=\"shared-songs\">\n          <h3>Shared Songs ({qrPayload.libraryManifest.length})</h3>\n          <ul class=\"song-list\">\n            {#each qrPayload.libraryManifest as song (song.id)}\n              <li class=\"song-item\">\n                <span class=\"song-title\">{song.title}</span>\n                {#if song.artist}\n                  <span class=\"song-artist\">{song.artist}</span>\n                {/if}\n              </li>\n            {/each}\n          </ul>\n        </div>\n      {/if}\n\n      <button class=\"btn btn-danger\" onclick={leaveSession}>\n        {isHosting ? 'End Session' : 'Leave Session'}\n      </button>\n    </div>\n  {:else}\n    <div class=\"session-options\">\n      {#if canHost}\n        <button class=\"option-card\" onclick={() => (showHostModal = true)}>\n          <span class=\"option-icon\">üì°</span>\n          <span class=\"option-title\">Start Session</span>\n          <span class=\"option-desc\">Host a session and share your songs</span>\n        </button>\n      {:else}\n        <div class=\"option-card disabled\">\n          <span class=\"option-icon\">üì°</span>\n          <span class=\"option-title\">Start Session</span>\n          <span class=\"option-desc\">Requires Pro subscription</span>\n          <a href=\"/account\" class=\"upgrade-link\">Upgrade</a>\n        </div>\n      {/if}\n\n      <button class=\"option-card\" onclick={() => (showJoinModal = true)}>\n        <span class=\"option-icon\">üì±</span>\n        <span class=\"option-title\">Join Session</span>\n        <span class=\"option-desc\">Scan a QR code to join</span>\n      </button>\n    </div>\n  {/if}\n</main>\n\n{#if showHostModal}\n  <div class=\"modal-overlay\" onclick={() => (showHostModal = false)}>\n    <div class=\"modal\" onclick={(e) => e.stopPropagation()}>\n      <h2>Start Sharing Session</h2>\n\n      <div class=\"form-group\">\n        <label class=\"checkbox-label\">\n          <input type=\"checkbox\" bind:checked={shareAll} disabled={creating} />\n          Share all songs\n        </label>\n      </div>\n\n      {#if !shareAll}\n        <div class=\"form-group\">\n          <label>Select songs to share:</label>\n          <div class=\"song-selector\">\n            {#each songs as song (song.id)}\n              <label class=\"song-checkbox\">\n                <input\n                  type=\"checkbox\"\n                  checked={selectedSongIds.includes(song.id)}\n                  onchange={() => toggleSongSelection(song.id)}\n                  disabled={creating}\n                />\n                <span>{song.title}</span>\n              </label>\n            {/each}\n          </div>\n        </div>\n      {/if}\n\n      <div class=\"form-group\">\n        <label for=\"password\">Password (optional)</label>\n        <input\n          type=\"password\"\n          id=\"password\"\n          bind:value={sessionPassword}\n          placeholder=\"Leave empty for open session\"\n          disabled={creating}\n        />\n      </div>\n\n      <div class=\"modal-actions\">\n        <button class=\"btn btn-secondary\" onclick={() => (showHostModal = false)} disabled={creating}>\n          Cancel\n        </button>\n        <button\n          class=\"btn btn-primary\"\n          onclick={startHosting}\n          disabled={creating || (!shareAll && selectedSongIds.length === 0)}\n        >\n          {creating ? 'Starting...' : 'Start Session'}\n        </button>\n      </div>\n    </div>\n  </div>\n{/if}\n\n{#if showJoinModal}\n  <div class=\"modal-overlay\" onclick={() => (showJoinModal = false)}>\n    <div class=\"modal modal-large\" onclick={(e) => e.stopPropagation()}>\n      <h2>Join Session</h2>\n\n      {#if joinError}\n        <div class=\"error-message\">{joinError}</div>\n      {/if}\n\n      <div id=\"qr-reader\" class=\"qr-reader\"></div>\n\n      {#if !scanning}\n        <button class=\"btn btn-primary\" onclick={joinWithQR}>\n          Start Camera\n        </button>\n      {:else}\n        <p class=\"scan-hint\">Point your camera at the host's QR code</p>\n      {/if}\n\n      <div class=\"modal-actions\">\n        <button class=\"btn btn-secondary\" onclick={() => (showJoinModal = false)}>\n          Cancel\n        </button>\n      </div>\n    </div>\n  </div>\n{/if}\n\n<style>\n  .page-header {\n    padding: var(--spacing-lg) 0;\n    border-bottom: 1px solid var(--color-border);\n  }\n\n  .header-left {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xs);\n  }\n\n  .back-link {\n    font-size: 0.875rem;\n    color: var(--color-text-muted);\n  }\n\n  .back-link:hover {\n    color: var(--color-primary);\n  }\n\n  .subtitle {\n    color: var(--color-text-muted);\n    font-size: 0.875rem;\n  }\n\n  .loading {\n    text-align: center;\n    padding: var(--spacing-xl);\n    color: var(--color-text-muted);\n  }\n\n  .session-options {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: var(--spacing-lg);\n    padding: var(--spacing-xl) 0;\n  }\n\n  .option-card {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: var(--spacing-xl);\n    background-color: var(--color-bg-secondary);\n    border: 2px solid transparent;\n    border-radius: var(--radius-lg);\n    cursor: pointer;\n    transition: all var(--transition-fast);\n    text-align: center;\n  }\n\n  .option-card:hover {\n    background-color: var(--color-surface);\n    border-color: var(--color-primary);\n  }\n\n  .option-icon {\n    font-size: 3rem;\n    margin-bottom: var(--spacing-md);\n  }\n\n  .option-title {\n    font-size: 1.25rem;\n    font-weight: 500;\n    margin-bottom: var(--spacing-xs);\n  }\n\n  .option-desc {\n    font-size: 0.875rem;\n    color: var(--color-text-muted);\n  }\n\n  .option-card.disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n\n  .option-card.disabled:hover {\n    background-color: var(--color-bg-secondary);\n    border-color: transparent;\n  }\n\n  .upgrade-link {\n    margin-top: var(--spacing-sm);\n    padding: var(--spacing-xs) var(--spacing-md);\n    background-color: var(--color-primary);\n    color: white;\n    border-radius: var(--radius-sm);\n    font-size: 0.75rem;\n    text-decoration: none;\n  }\n\n  .active-session {\n    padding: var(--spacing-xl) 0;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: var(--spacing-lg);\n  }\n\n  .session-status {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-md);\n    padding: var(--spacing-md);\n    background-color: var(--color-bg-secondary);\n    border-radius: var(--radius-lg);\n  }\n\n  .status-indicator {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    background-color: var(--color-text-muted);\n  }\n\n  .status-indicator.connected {\n    background-color: #4ade80;\n  }\n\n  .status-text {\n    font-weight: 500;\n  }\n\n  .peer-count {\n    color: var(--color-text-muted);\n    font-size: 0.875rem;\n  }\n\n  .qr-section {\n    text-align: center;\n    padding: var(--spacing-lg);\n    background-color: var(--color-bg-secondary);\n    border-radius: var(--radius-lg);\n  }\n\n  .qr-section h3 {\n    margin: 0 0 var(--spacing-md);\n  }\n\n  .qr-code {\n    max-width: 250px;\n    border-radius: var(--radius-md);\n    background-color: white;\n    padding: var(--spacing-md);\n  }\n\n  .qr-hint {\n    margin-top: var(--spacing-md);\n    font-size: 0.875rem;\n    color: var(--color-text-muted);\n  }\n\n  .shared-songs {\n    width: 100%;\n    max-width: 400px;\n  }\n\n  .shared-songs h3 {\n    margin-bottom: var(--spacing-md);\n  }\n\n  .song-list {\n    list-style: none;\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xs);\n    max-height: 200px;\n    overflow-y: auto;\n  }\n\n  .song-item {\n    display: flex;\n    flex-direction: column;\n    padding: var(--spacing-sm);\n    background-color: var(--color-bg-secondary);\n    border-radius: var(--radius-sm);\n  }\n\n  .song-title {\n    font-weight: 500;\n  }\n\n  .song-artist {\n    font-size: 0.75rem;\n    color: var(--color-text-muted);\n  }\n\n  .btn-danger {\n    background-color: var(--color-primary);\n    color: white;\n  }\n\n  /* Modal */\n  .modal-overlay {\n    position: fixed;\n    inset: 0;\n    background-color: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 100;\n    padding: var(--spacing-md);\n  }\n\n  .modal {\n    background-color: var(--color-bg);\n    border-radius: var(--radius-lg);\n    padding: var(--spacing-lg);\n    width: 100%;\n    max-width: 400px;\n    max-height: 90vh;\n    overflow-y: auto;\n  }\n\n  .modal-large {\n    max-width: 500px;\n  }\n\n  .modal h2 {\n    margin: 0 0 var(--spacing-lg);\n  }\n\n  .error-message {\n    background-color: rgba(233, 69, 96, 0.1);\n    border: 1px solid var(--color-primary);\n    color: var(--color-primary);\n    padding: var(--spacing-sm);\n    border-radius: var(--radius-md);\n    margin-bottom: var(--spacing-md);\n  }\n\n  .form-group {\n    margin-bottom: var(--spacing-md);\n  }\n\n  .form-group label {\n    display: block;\n    margin-bottom: var(--spacing-xs);\n    font-size: 0.875rem;\n    color: var(--color-text-muted);\n  }\n\n  .checkbox-label {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-sm);\n    cursor: pointer;\n  }\n\n  .checkbox-label input {\n    width: auto;\n  }\n\n  .song-selector {\n    max-height: 200px;\n    overflow-y: auto;\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-xs);\n  }\n\n  .song-checkbox {\n    display: flex;\n    align-items: center;\n    gap: var(--spacing-sm);\n    padding: var(--spacing-xs);\n    cursor: pointer;\n  }\n\n  .song-checkbox input {\n    width: auto;\n  }\n\n  .qr-reader {\n    width: 100%;\n    margin-bottom: var(--spacing-md);\n  }\n\n  .scan-hint {\n    text-align: center;\n    color: var(--color-text-muted);\n    font-size: 0.875rem;\n  }\n\n  .modal-actions {\n    display: flex;\n    justify-content: flex-end;\n    gap: var(--spacing-sm);\n    margin-top: var(--spacing-lg);\n  }\n</style>\n"],"file":"_app/immutable/nodes/6.Day0pw_S.js"}