{"version":3,"mappings":"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","names":["title","$.state","artist","key","tempo","instrument","tags","creating","error","user","canCreate","hasLoaded","$.user_effect","browser","loadUser","getDatabase","users","$.set","hasPermission","$.get","handleSubmit","e","createSong","createArrangement","__vitePreload","SongRepository","ArrangementRepository","userId","parsedTags","t","song","arrangement","goto","err","main","root","$.head","$$anchor","div","root_2","form","root_3","div_1","root_4","$$render","consequent_1","div_2","$.sibling","node_1","input","$.child","$.remove_input_defaults","div_3","input_1","div_4","div_5","select","option","$.each","node_2","MUSICAL_KEYS","k","option_1","root_5","div_6","input_2","div_7","select_1","INSTRUMENTS","$.index","inst","option_2","root_6","div_8","input_3","div_9","button","consequent_2","alternate","$.event","$$value","consequent","alternate_1"],"ignoreList":[],"sources":["../../../../../../src/routes/songs/new/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { browser } from '$app/environment';\n  import { goto } from '$app/navigation';\n  import { INSTRUMENTS, MUSICAL_KEYS, type Instrument, type MusicalKey, type User, hasPermission } from '@gigwidget/core';\n\n  let title = $state('');\n  let artist = $state('');\n  let key = $state<MusicalKey | ''>('');\n  let tempo = $state<number | ''>('');\n  let instrument = $state<Instrument>('guitar');\n  let tags = $state('');\n  let creating = $state(false);\n  let error = $state<string | null>(null);\n  let user = $state<User | null>(null);\n  let canCreate = $state(false);\n  let hasLoaded = false;\n\n  $effect(() => {\n    if (!browser || hasLoaded) return;\n    hasLoaded = true;\n    loadUser();\n  });\n\n  async function loadUser() {\n    const { getDatabase } = await import('@gigwidget/db');\n    const db = getDatabase();\n    const users = await db.users.toArray();\n    if (users.length > 0) {\n      user = users[0];\n      canCreate = hasPermission(user, 'create_songs');\n    }\n  }\n\n  async function handleSubmit(e: SubmitEvent) {\n    e.preventDefault();\n\n    if (!title.trim()) {\n      error = 'Title is required';\n      return;\n    }\n\n    creating = true;\n    error = null;\n\n    try {\n      const { createSong, createArrangement } = await import('@gigwidget/core');\n      const { SongRepository, ArrangementRepository, getDatabase } = await import('@gigwidget/db');\n\n      const db = getDatabase();\n      const users = await db.users.toArray();\n      if (users.length === 0) {\n        throw new Error('No user found');\n      }\n\n      const userId = users[0].id;\n      const parsedTags = tags\n        .split(',')\n        .map((t) => t.trim())\n        .filter((t) => t.length > 0);\n\n      const song = createSong(userId, title.trim(), {\n        artist: artist.trim() || undefined,\n        key: key || undefined,\n        tempo: tempo ? Number(tempo) : undefined,\n        tags: parsedTags,\n        visibility: 'private',\n      });\n\n      const arrangement = createArrangement(song.id, instrument, {\n        content: `{title: ${song.title}}\\n{artist: ${song.artist || 'Unknown'}}\\n\\n`,\n      });\n\n      await SongRepository.create(song);\n      await ArrangementRepository.create(arrangement);\n\n      goto(`/songs/${song.id}`);\n    } catch (err) {\n      console.error('Failed to create song:', err);\n      error = err instanceof Error ? err.message : 'Failed to create song';\n      creating = false;\n    }\n  }\n</script>\n\n<svelte:head>\n  <title>New Song - Gigwidget</title>\n</svelte:head>\n\n<main class=\"container\">\n  <header class=\"page-header\">\n    <div class=\"header-left\">\n      <a href=\"/songs\" class=\"back-link\">‚Üê Back to Songs</a>\n      <h1>New Song</h1>\n    </div>\n  </header>\n\n  {#if !canCreate && user}\n    <div class=\"upgrade-notice\">\n      <h2>Upgrade Required</h2>\n      <p>Creating songs requires a Basic subscription or higher.</p>\n      <a href=\"/account\" class=\"btn btn-primary\">View Plans</a>\n    </div>\n  {:else}\n  <form class=\"song-form\" onsubmit={handleSubmit}>\n    {#if error}\n      <div class=\"error-message\">{error}</div>\n    {/if}\n\n    <div class=\"form-group\">\n      <label for=\"title\">Title *</label>\n      <input\n        type=\"text\"\n        id=\"title\"\n        bind:value={title}\n        placeholder=\"Enter song title\"\n        required\n        disabled={creating}\n      />\n    </div>\n\n    <div class=\"form-group\">\n      <label for=\"artist\">Artist</label>\n      <input\n        type=\"text\"\n        id=\"artist\"\n        bind:value={artist}\n        placeholder=\"Enter artist name\"\n        disabled={creating}\n      />\n    </div>\n\n    <div class=\"form-row\">\n      <div class=\"form-group\">\n        <label for=\"key\">Key</label>\n        <select id=\"key\" bind:value={key} disabled={creating}>\n          <option value=\"\">Select key</option>\n          {#each MUSICAL_KEYS as k}\n            <option value={k}>{k}</option>\n          {/each}\n        </select>\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"tempo\">Tempo (BPM)</label>\n        <input\n          type=\"number\"\n          id=\"tempo\"\n          bind:value={tempo}\n          placeholder=\"120\"\n          min=\"20\"\n          max=\"300\"\n          disabled={creating}\n        />\n      </div>\n    </div>\n\n    <div class=\"form-group\">\n      <label for=\"instrument\">Primary Instrument</label>\n      <select id=\"instrument\" bind:value={instrument} disabled={creating}>\n        {#each INSTRUMENTS as inst}\n          <option value={inst}>{inst.charAt(0).toUpperCase() + inst.slice(1)}</option>\n        {/each}\n      </select>\n    </div>\n\n    <div class=\"form-group\">\n      <label for=\"tags\">Tags</label>\n      <input\n        type=\"text\"\n        id=\"tags\"\n        bind:value={tags}\n        placeholder=\"rock, classic, favorite (comma-separated)\"\n        disabled={creating}\n      />\n    </div>\n\n    <div class=\"form-actions\">\n      <a href=\"/songs\" class=\"btn btn-secondary\">Cancel</a>\n      <button type=\"submit\" class=\"btn btn-primary\" disabled={creating}>\n        {#if creating}\n          Creating...\n        {:else}\n          Create Song\n        {/if}\n      </button>\n    </div>\n  </form>\n  {/if}\n</main>\n\n<style>\n  .upgrade-notice {\n    text-align: center;\n    padding: var(--spacing-xl);\n    background-color: var(--color-bg-secondary);\n    border-radius: var(--radius-lg);\n    margin-top: var(--spacing-xl);\n  }\n\n  .upgrade-notice h2 {\n    margin-bottom: var(--spacing-sm);\n  }\n\n  .upgrade-notice p {\n    color: var(--color-text-muted);\n    margin-bottom: var(--spacing-lg);\n  }\n\n  .page-header {\n    padding: var(--spacing-lg) 0;\n    border-bottom: 1px solid var(--color-border);\n  }\n\n  .header-left {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-sm);\n  }\n\n  .back-link {\n    font-size: 0.875rem;\n    color: var(--color-text-muted);\n  }\n\n  .back-link:hover {\n    color: var(--color-primary);\n  }\n\n  .song-form {\n    max-width: 600px;\n    margin: var(--spacing-xl) auto;\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-lg);\n  }\n\n  .error-message {\n    background-color: rgba(233, 69, 96, 0.1);\n    border: 1px solid var(--color-primary);\n    color: var(--color-primary);\n    padding: var(--spacing-md);\n    border-radius: var(--radius-md);\n  }\n\n  .form-group {\n    display: flex;\n    flex-direction: column;\n    gap: var(--spacing-sm);\n  }\n\n  .form-group label {\n    font-weight: 500;\n    font-size: 0.875rem;\n    color: var(--color-text-muted);\n  }\n\n  .form-row {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: var(--spacing-md);\n  }\n\n  select {\n    appearance: none;\n    background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23a0a0a0' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E\");\n    background-repeat: no-repeat;\n    background-position: right var(--spacing-md) center;\n    padding-right: 2.5rem;\n  }\n\n  .form-actions {\n    display: flex;\n    justify-content: flex-end;\n    gap: var(--spacing-md);\n    padding-top: var(--spacing-md);\n    border-top: 1px solid var(--color-border);\n  }\n\n  button:disabled,\n  input:disabled,\n  select:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n\n  @media (max-width: 500px) {\n    .form-row {\n      grid-template-columns: 1fr;\n    }\n  }\n</style>\n"],"file":"_app/immutable/nodes/11.pbiNaxxc.js"}