const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/C6md0y2C.js","../chunks/CKx7fsl1.js","../chunks/BMDA9hg8.js","../chunks/BhPu-S6K.js","../chunks/CDUSxSYR.js","../chunks/Dyjw1x4N.js","../chunks/BDmV6bVE.js","../chunks/xpSNPyDo.js","../chunks/cnc2SBSL.js","../assets/chordpro-editor.B3NEMwJP.css","../chunks/D3n2sll8.js","../chunks/Cpj98o6Y.js","../chunks/DhSYb-d6.js"])))=>i.map(i=>d[i]);
import{r as $t,Z as r,a1 as a,a0 as c,a2 as b,b as t,a5 as Lt,V as xe,W as C,c as he,X as Kt,a3 as W,Y as we,_ as z,s as o,a7 as ke,$ as Ae,a4 as Nt}from"../chunks/cnc2SBSL.js";import{f as d,s as w,a as s,d as Ee,c as ft,t as mt,e as Se}from"../chunks/Caf-0pf-.js";import{i as f,b as Ce}from"../chunks/Coh7MiEg.js";import{h as Te,e as kt,i as At}from"../chunks/ClOXSIRR.js";import{s as Re,r as De,b as Et}from"../chunks/L9orpk0O.js";import{s as Q}from"../chunks/oTU1mMgh.js";import{a as Pe}from"../chunks/_dvcZOuR.js";import{s as Le,a as Ie}from"../chunks/C8OxQ71e.js";import{p as Be}from"../chunks/DSNcCDqV.js";import{g as Fe}from"../chunks/BJEHMrWO.js";import{a as Oe}from"../chunks/CxA4e2Oe.js";import{p as Pt}from"../chunks/DckVQdqG.js";function Ve(j,M,dt,Y){var tt=j.__style;if($t||tt!==M){var v=Oe(M,Y);(!$t||v!==j.getAttribute("style"))&&(v==null?j.removeAttribute("style"):j.style.cssText=v),j.__style=M}return Y}var je=d('<span class="status-label svelte-15e08h8"> </span>'),Me=d('<span class="peer-count svelte-15e08h8"> </span>'),Ye=d("<div><span> </span> <!> <!></div>");function Ge(j,M){let dt=Pt(M,"status",3,"offline"),Y=Pt(M,"peerCount",3,0),tt=Pt(M,"compact",3,!1);const v={synced:{label:"Synced",icon:"●",color:"var(--color-success, #4ade80)"},syncing:{label:"Syncing...",icon:"◐",color:"var(--color-warning, #fbbf24)"},offline:{label:"Offline",icon:"○",color:"var(--color-text-muted)"},error:{label:"Sync Error",icon:"✕",color:"var(--color-primary)"}},G=Lt(()=>v[dt()]);var u=Ye();let et;var F=r(u);let O;var T=r(F,!0);a(F);var X=c(F,2);{var gt=p=>{var k=je(),Z=r(k,!0);a(k),b(()=>w(Z,t(G).label)),s(p,k)};f(X,p=>{tt()||p(gt)})}var bt=c(X,2);{var yt=p=>{var k=Me(),Z=r(k,!0);a(k),b(()=>{Re(k,"title",`${Y()??""} connected peer${Y()>1?"s":""}`),w(Z,Y())}),s(p,k)};f(bt,p=>{Y()>0&&p(yt)})}a(u),b(()=>{et=Q(u,1,"sync-indicator svelte-15e08h8",null,et,{compact:tt()}),Ve(u,`--status-color: ${t(G).color??""}`),O=Q(F,1,"status-icon svelte-15e08h8",null,O,{syncing:dt()==="syncing"}),w(T,t(G).icon)}),s(j,u)}var $e=d('<div class="loading svelte-1358xlt">Loading song...</div>'),Ke=d('<div class="error-container svelte-1358xlt"><p> </p> <a href="/songs" class="btn btn-secondary">Back to Songs</a></div>'),Ne=d('<span class="song-artist svelte-1358xlt"> </span>'),ze=d('<span class="meta-item svelte-1358xlt"> </span>'),Je=d('<span class="meta-item svelte-1358xlt"> </span>'),Ue=d('<span class="tag svelte-1358xlt"> </span>'),We=d('<div class="tags svelte-1358xlt"></div>'),Xe=d('<button class="reset-btn svelte-1358xlt">Reset</button>'),Ze=d('<div class="transpose-controls svelte-1358xlt"><div class="transpose-buttons svelte-1358xlt"><button class="transpose-btn svelte-1358xlt" title="Transpose down">-1</button> <button class="transpose-display svelte-1358xlt" title="Click to transpose to key"><!></button> <button class="transpose-btn svelte-1358xlt" title="Transpose up">+1</button></div> <!></div>'),qe=d("<button> <!></button>"),He=d('<nav class="arrangement-tabs svelte-1358xlt"></nav>'),Qe=d('<div class="editor-wrapper svelte-1358xlt"><chordpro-editor></chordpro-editor></div> <div class="editor-actions svelte-1358xlt"><span class="save-status svelte-1358xlt"><!></span> <button class="btn btn-primary">Save Now</button></div>',3),ta=d('<div class="loading svelte-1358xlt">Loading editor...</div>'),ea=d('<div class="renderer-wrapper svelte-1358xlt"><chordpro-renderer></chordpro-renderer></div>',2),aa=d('<div class="empty-state svelte-1358xlt"><p>No arrangement found for this song.</p></div>'),ra=d('<div class="loading svelte-1358xlt">Loading viewer...</div>'),sa=d('<header class="page-header svelte-1358xlt"><div class="header-left svelte-1358xlt"><a href="/songs" class="back-link svelte-1358xlt">← Back to Songs</a> <h1> </h1> <!></div> <div class="header-actions svelte-1358xlt"><button class="btn btn-secondary svelte-1358xlt"> </button> <button class="btn btn-danger svelte-1358xlt">Delete</button></div></header> <div class="song-meta svelte-1358xlt"><!> <!> <!> <!></div> <!> <!> <div class="editor-container svelte-1358xlt"><!></div>',1),oa=d("<button> </button>"),na=d("<button> </button>"),la=d('<div class="transpose-section svelte-1358xlt"><h4 class="svelte-1358xlt"> </h4> <div class="key-grid svelte-1358xlt"></div></div>'),ia=d('<div class="modal-overlay svelte-1358xlt"><div class="modal svelte-1358xlt"><h2 class="svelte-1358xlt">Transpose</h2> <div class="transpose-options svelte-1358xlt"><div class="transpose-section svelte-1358xlt"><h4 class="svelte-1358xlt">By Semitones</h4> <div class="semitone-grid svelte-1358xlt"></div></div> <!> <div class="transpose-section"><label class="checkbox-label svelte-1358xlt"><input type="checkbox" class="svelte-1358xlt"/> Prefer flats (Bb instead of A#)</label></div></div> <div class="modal-actions svelte-1358xlt"><button class="btn btn-secondary">Close</button></div></div></div>'),va=d('<main class="container"><!></main> <!>',1);function wa(j,M){xe(M,!0);const dt=()=>Ie(Be,"$page",Y),[Y,tt]=Le();let v=C(null),G=C(he([])),u=C(null),et=C(!0),F=C(null),O=C(!1),T=C(""),X=C(!1),gt=!1,bt=C(!1),yt=C(!1),p=C(0),k=C(!1),Z=C(!1),St=C("offline"),zt=0,J=null,U=null,at=null,xt=null;const Jt=Lt(()=>t(u)?t(p)===0?t(u).content:It(t(u).content,t(p)):"");let It=(e,_)=>e;const Ct=Lt(()=>dt().params.id);Kt(()=>{!Ce||gt||(gt=!0,Zt(),Xt(),Ut())}),Kt(()=>()=>{xt&&xt.destroy(),J&&J.destroy()});async function Ut(){try{const e=await z(()=>import("../chunks/CKx7fsl1.js").then(n=>n.T),[],import.meta.url),{IndexeddbPersistence:_}=await z(async()=>{const{IndexeddbPersistence:n}=await import("../chunks/C6md0y2C.js");return{IndexeddbPersistence:n}},__vite__mapDeps([0,1]),import.meta.url),{transposeChordProContent:S}=await z(async()=>{const{transposeChordProContent:n}=await import("../chunks/BMDA9hg8.js");return{transposeChordProContent:n}},__vite__mapDeps([2,3,4,1,5]),import.meta.url);It=(n,P)=>S(n,P,t(Z)),J=new e.Doc,U=J.getText("content"),at=J.getMap("transpose"),xt=new _(`song-${t(Ct)}`,J),xt.on("synced",()=>{o(St,"synced");const n=U.toString();n&&n.length>0&&o(T,n,!0);const P=at.get("semitones");typeof P=="number"&&o(p,P,!0)}),U.observe(()=>{const n=U.toString();n!==t(T)&&o(T,n,!0)}),at.observe(()=>{const n=at.get("semitones");typeof n=="number"&&n!==t(p)&&o(p,n,!0)})}catch(e){console.error("Failed to initialize Yjs:",e),o(St,"error")}}function Wt(e){!J||!U||J.transact(()=>{U.delete(0,U.length),U.insert(0,e)})}async function Xt(){try{await z(()=>import("../chunks/BDmV6bVE.js").then(e=>e.c),__vite__mapDeps([6,7,8,9]),import.meta.url),o(bt,!0)}catch(e){console.error("Failed to load chordpro-editor:",e)}try{await z(()=>import("../chunks/D3n2sll8.js"),__vite__mapDeps([10,7,11]),import.meta.url),o(yt,!0)}catch(e){console.error("Failed to load chordpro-renderer:",e)}}async function Zt(){try{const{SongRepository:e,ArrangementRepository:_}=await z(async()=>{const{SongRepository:n,ArrangementRepository:P}=await import("../chunks/DhSYb-d6.js");return{SongRepository:n,ArrangementRepository:P}},__vite__mapDeps([12,11,4,1]),import.meta.url),S=await e.getById(t(Ct));if(!S){o(F,"Song not found"),o(et,!1);return}o(v,S,!0),o(G,await _.getBySong(t(Ct)),!0),t(G).length>0&&(o(u,t(G)[0],!0),o(T,t(u).content,!0))}catch(e){console.error("Failed to load song:",e),o(F,e instanceof Error?e.message:"Failed to load song",!0)}finally{o(et,!1)}}function qt(e){o(T,e.detail.content,!0),Wt(e.detail.content)}async function Tt(){if(!(!t(u)||!t(v))){o(X,!0);try{const{ArrangementRepository:e,SongRepository:_}=await z(async()=>{const{ArrangementRepository:S,SongRepository:n}=await import("../chunks/DhSYb-d6.js");return{ArrangementRepository:S,SongRepository:n}},__vite__mapDeps([12,11,4,1]),import.meta.url);await e.update(t(u).id,{content:t(T),version:t(u).version+1}),await _.update(t(v).id,{}),o(u,{...t(u),content:t(T),version:t(u).version+1,updatedAt:new Date},!0)}catch(e){console.error("Failed to save:",e)}finally{o(X,!1)}}}function Ht(){t(O)&&t(T)!==t(u)?.content&&Tt(),o(O,!t(O))}function Qt(e){t(O)&&t(T)!==t(u)?.content&&Tt(),o(u,e,!0),o(T,e.content,!0)}async function te(){if(t(v)&&confirm("Are you sure you want to delete this song? This cannot be undone."))try{const{SongRepository:e}=await z(async()=>{const{SongRepository:_}=await import("../chunks/DhSYb-d6.js");return{SongRepository:_}},__vite__mapDeps([12,11,4,1]),import.meta.url);await e.delete(t(v).id),Fe("/songs")}catch(e){console.error("Failed to delete song:",e),o(F,"Failed to delete song")}}function ht(e){o(p,e,!0),at&&at.set("semitones",e)}function Bt(e){const _=((t(p)+e)%12+12)%12;ht(_>6?_-12:_)}async function ee(e){if(!t(v)?.key)return;const{getSemitonesBetweenKeys:_}=await z(async()=>{const{getSemitonesBetweenKeys:n}=await import("../chunks/BMDA9hg8.js");return{getSemitonesBetweenKeys:n}},__vite__mapDeps([2,3,4,1,5]),import.meta.url),S=_(t(v).key,e);ht(S),o(k,!1)}function ae(){ht(0)}const re=["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"],se=["Am","A#m","Bbm","Bm","Cm","C#m","Dm","D#m","Ebm","Em","Fm","F#m","Gm","G#m"];var Ft=va();Te("1358xlt",e=>{ke(()=>{Ae.title=`${t(v)?.title??"Loading..."??""} - Gigwidget`})});var Rt=W(Ft),oe=r(Rt);{var ne=e=>{var _=$e();s(e,_)},le=e=>{var _=ft(),S=W(_);{var n=$=>{var K=Ke(),rt=r(K),st=r(rt,!0);a(rt),Nt(2),a(K),b(()=>w(st,t(F))),s($,K)},P=$=>{var K=ft(),rt=W(K);{var st=ot=>{var _t=sa(),nt=W(_t),ut=r(nt),R=c(r(ut),2),L=r(R,!0);a(R);var B=c(R,2);{var lt=l=>{var i=Ne(),y=r(i);a(i),b(()=>w(y,`by ${t(v).artist??""}`)),s(l,i)};f(B,l=>{t(v).artist&&l(lt)})}a(ut);var q=c(ut,2),it=r(q);it.__click=Ht;var pt=r(it,!0);a(it);var H=c(it,2);H.__click=te,a(q),a(nt);var vt=c(nt,2),wt=r(vt);Ge(wt,{get status(){return t(St)},peerCount:zt});var Ot=c(wt,2);{var ce=l=>{var i=ze(),y=r(i);a(i),b(()=>w(y,`Key: ${t(v).key??""}`)),s(l,i)};f(Ot,l=>{t(v).key&&l(ce)})}var Vt=c(Ot,2);{var de=l=>{var i=Je(),y=r(i);a(i),b(()=>w(y,`${t(v).tempo??""} BPM`)),s(l,i)};f(Vt,l=>{t(v).tempo&&l(de)})}var _e=c(Vt,2);{var ue=l=>{var i=We();kt(i,21,()=>t(v).tags,At,(y,A)=>{var g=Ue(),m=r(g,!0);a(g),b(()=>w(m,t(A))),s(y,g)}),a(i),s(l,i)};f(_e,l=>{t(v).tags.length>0&&l(ue)})}a(vt);var jt=c(vt,2);{var pe=l=>{var i=Ze(),y=r(i),A=r(y);A.__click=()=>Bt(-1);var g=c(A,2);g.__click=()=>o(k,!0);var m=r(g);{var x=h=>{var N=mt("Original");s(h,N)},D=h=>{var N=mt();b(()=>w(N,`${t(p)>0?"+":""}${t(p)??""}`)),s(h,N)};f(m,h=>{t(p)===0?h(x):h(D,!1)})}a(g);var V=c(g,2);V.__click=()=>Bt(1),a(y);var I=c(y,2);{var E=h=>{var N=Xe();N.__click=ae,s(h,N)};f(I,h=>{t(p)!==0&&h(E)})}a(i),s(l,i)};f(jt,l=>{t(O)||l(pe)})}var Mt=c(jt,2);{var fe=l=>{var i=He();kt(i,21,()=>t(G),At,(y,A)=>{var g=qe();let m;g.__click=()=>Qt(t(A));var x=r(g),D=c(x);{var V=I=>{var E=mt();b(()=>w(E,`(Capo ${t(A).capo??""})`)),s(I,E)};f(D,I=>{t(A).capo&&I(V)})}a(g),b(I=>{m=Q(g,1,"arrangement-tab svelte-1358xlt",null,m,{active:t(u)?.id===t(A).id}),w(x,`${I??""} `)},[()=>t(A).instrument.charAt(0).toUpperCase()+t(A).instrument.slice(1)]),s(y,g)}),a(i),s(l,i)};f(Mt,l=>{t(G).length>1&&l(fe)})}var Yt=c(Mt,2),me=r(Yt);{var ge=l=>{var i=ft(),y=W(i);{var A=m=>{var x=Qe(),D=W(x),V=r(D);b(()=>Et(V,"content",t(T))),Et(V,"theme","chordpro-dark"),Q(V,1,"svelte-1358xlt"),a(D);var I=c(D,2),E=r(I),h=r(E);{var N=ct=>{var Dt=mt("Saving...");s(ct,Dt)},ye=ct=>{var Dt=mt("Auto-saved");s(ct,Dt)};f(h,ct=>{t(X)?ct(N):ct(ye,!1)})}a(E);var Gt=c(E,2);Gt.__click=Tt,a(I),b(()=>Gt.disabled=t(X)),Se("content-changed",V,qt),s(m,x)},g=m=>{var x=ta();s(m,x)};f(y,m=>{t(bt)?m(A):m(g,!1)})}s(l,i)},be=l=>{var i=ft(),y=W(i);{var A=m=>{var x=ea(),D=r(x);b(()=>Et(D,"content",t(Jt))),Et(D,"theme","chordpro-dark"),Q(D,1,"svelte-1358xlt"),a(x),s(m,x)},g=m=>{var x=ft(),D=W(x);{var V=E=>{var h=aa();s(E,h)},I=E=>{var h=ra();s(E,h)};f(D,E=>{t(u)?E(I,!1):E(V)},!0)}s(m,x)};f(y,m=>{t(yt)&&t(u)?m(A):m(g,!1)})}s(l,i)};f(me,l=>{t(O)?l(ge):l(be,!1)})}a(Yt),b(()=>{w(L,t(v).title),w(pt,t(O)?"View":"Edit")}),s(ot,_t)};f(rt,ot=>{t(v)&&ot(st)},!0)}s($,K)};f(S,$=>{t(F)?$(n):$(P,!1)},!0)}s(e,_)};f(oe,e=>{t(et)?e(ne):e(le,!1)})}a(Rt);var ie=c(Rt,2);{var ve=e=>{var _=ia();_.__click=()=>o(k,!1);var S=r(_);S.__click=R=>R.stopPropagation();var n=c(r(S),2),P=r(n),$=c(r(P),2);kt($,20,()=>[-5,-4,-3,-2,-1,0,1,2,3,4,5,6],At,(R,L)=>{var B=oa();let lt;B.__click=()=>{ht(L),o(k,!1)};var q=r(B,!0);a(B),b(()=>{lt=Q(B,1,"semitone-btn svelte-1358xlt",null,lt,{active:t(p)===L}),w(q,L===0?"0":L>0?`+${L}`:L)}),s(R,B)}),a($),a(P);var K=c(P,2);{var rt=R=>{var L=la(),B=r(L),lt=r(B);a(B);var q=c(B,2);kt(q,21,()=>t(v).key.includes("m")?se:re,At,(it,pt)=>{var H=na();let vt;H.__click=()=>ee(t(pt));var wt=r(H,!0);a(H),b(()=>{vt=Q(H,1,"key-btn svelte-1358xlt",null,vt,{active:t(pt)===t(v).key&&t(p)===0}),w(wt,t(pt))}),s(it,H)}),a(q),a(L),b(()=>w(lt,`To Key (from ${t(v).key??""})`)),s(R,L)};f(K,R=>{t(v)?.key&&R(rt)})}var st=c(K,2),ot=r(st),_t=r(ot);De(_t),Nt(),a(ot),a(st),a(n);var nt=c(n,2),ut=r(nt);ut.__click=()=>o(k,!1),a(nt),a(S),a(_),Pe(_t,()=>t(Z),R=>o(Z,R)),s(e,_)};f(ie,e=>{t(k)&&e(ve)})}s(j,Ft),we(),tt()}Ee(["click"]);export{wa as component};
//# sourceMappingURL=10.DuYsN0F1.js.map
